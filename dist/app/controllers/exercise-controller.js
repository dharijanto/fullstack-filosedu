"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const Promise=require("bluebird"),course_service_1=require("../../services/course-service"),exercise_service_1=require("../../services/exercise-service");let path=require("path"),moment=require("moment-timezone"),log=require("npmlog"),AnalyticsService=require(path.join(__dirname,"../../services/analytics-service")),BaseController=require(path.join(__dirname,"base-controller")),PassportHelper=require(path.join(__dirname,"../utils/passport-helper")),PathFormatter=require(path.join(__dirname,"../../lib/path-formatter")),Formatter=require(path.join(__dirname,"../../lib/utils/formatter")),Utils=require(path.join(__dirname,"../utils/utils"));const TAG="ExerciseController";class ExerciseController extends BaseController{initialize(){return Promise.join(PathFormatter.hashAsset("app","/assets/js/exercise-app-bundle.js"),PathFormatter.hashAsset("app","/assets/js/competency-exercise-logistic-app-bundle.js"),PathFormatter.hashAsset("app","/assets/js/competency-exercise-app-bundle.js")).spread((e,s,r)=>{this.exerciseFrontendJS=e,this.competencyExerciseLogiscticJS=s,this.competencyExerciseJS=r})}constructor(e){super(e);const s=new AnalyticsService(this.getDb().sequelize,this.getDb().models);this.addInterceptor((e,s,r)=>{r()}),this.routeGet("/:topicId/:topicSlug/:subtopicId/:subtopicSlug/:exerciseId/:exerciseSlug",PassportHelper.ensureLoggedIn(),(e,s,r)=>{const t=e.user.id,i=e.params.exerciseId,a=e.params.subtopicId;Promise.join(exercise_service_1.default.getFormattedExercise(i,t),exercise_service_1.default.getRenderedExerciseStars(t,i),exercise_service_1.default.getRenderedExerciseTimers(t,i),course_service_1.default.getPreviousAndNextExercise(a,i),course_service_1.default.getPreviousAndNextSubtopic(a),course_service_1.default.getSubtopic(a)).spread((e,t,i,a,c,o)=>{if(e.status&&e.data&&a.status&&a.data&&c.status&&c.data&&o.status&&o.data){const r=a.data,d=c.data;s.locals.formattedExercise=e.data.formattedExercise,s.locals.elapsedTime=e.data.elapsedTime,s.locals.idealTime=e.data.idealTime,s.locals.exerciseId=e.data.exerciseId,s.locals.prevLink=r&&r.prev?Formatter.getExerciseURL(r.prev):d&&d.prev?Formatter.getSubtopicURL(d.prev):null,s.locals.nextLink=r&&r.next?Formatter.getExerciseURL(r.next):d&&d.next?Formatter.getSubtopicURL(d.next):null,s.locals.starsHTML=t.status?t.data:'<p style="color:red;"> Unable to retrieve stars... </p>',s.locals.timersHTML=i.status?i.data:'<p style="color:red;"> Unable to retrieve timers... </p>',s.locals.subtopic=o.data,s.locals.bundle=this.exerciseFrontendJS,s.render("exercise")}else r(new Error(e.errMessage||a.errMessage||c.errMessage||o.errMessage))}).catch(r)}),this.routeGet("/getExerciseStars",PassportHelper.ensureLoggedIn(),(e,s,r)=>{const t=parseInt(e.query.exerciseId,10);void 0===t?s.json({status:!1,errMessage:"exerciseId is needed"}):e.isAuthenticated?exercise_service_1.default.getExerciseStars(e.user.id,t).then(e=>{s.json(e)}).catch(e=>{r(e)}):s.json({status:!1,errMessage:"Unauthorized"})}),this.routePost("/exercise/getLeaderboard",(e,s,r)=>{const t=parseInt(e.body.exerciseId,10);void 0===t?s.json({status:!1,errMessage:"exerciseId is needed"}):e.isAuthenticated?exercise_service_1.default.getExerciseLeaderboard(t).then(e=>{s.json(e)}).catch(e=>{r(e)}):s.json({status:!1,errMessage:"Unauthorized"})}),this.routePost("/:topicId/:topicSlug/:subtopicId/:subtopicSlug/:exerciseId/:exerciseSlug",PassportHelper.ensureLoggedIn(),(e,r,t)=>{const i=e.user.id,a=e.body.exerciseId,c=e.body.answers;console.dir(e.body),exercise_service_1.default.finishExercise(a,i,c).then(e=>{if(r.status&&e.data){const t=e.data,o=c.reduce((e,s)=>{return Object.values(s).reduce((e,s)=>e||s.length>0,!1)?e+1:0},0)/c.length*100;s.addExerciseSubmissionStats(t.score,o,a,i).then(e=>{e.status||log.error(TAG,"submitAnswer.POST(): failed to add analytics: "+JSON.stringify(e))}).catch(e=>log.error(TAG,e)),Promise.join(exercise_service_1.default.getRenderedExerciseStars(i,a),exercise_service_1.default.getExerciseLeaderboard(a),exercise_service_1.default.getCurrentRanking(t.timeFinish,a),exercise_service_1.default.getTotalRanking(a),exercise_service_1.default.getRenderedExerciseTimers(i,a)).spread((e,s,i,a,c)=>{r.json({status:!0,data:{correctAnswers:t.correctAnswers,isCorrect:t.isCorrect,score:t.score,starsHTML:e.data,timersHTML:c.data,ranking:s.data,timeFinish:t.timeFinish,currentRanking:i.data.count,totalRanking:a.data.count}})})}})}),this.routePost("/exercise/analytics",(e,r,t)=>{const i=e.body.key,a=e.body.exerciseId,c=e.user&&e.user.id||-1,o=e.body.value;s.addExerciseData(i,o,a,c).then(e=>{r.json(e)}).catch(e=>{t(e)})})}}module.exports=ExerciseController;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9hcHAvY29udHJvbGxlcnMvZXhlcmNpc2UtY29udHJvbGxlci50cyJdLCJuYW1lcyI6WyJQcm9taXNlIiwicmVxdWlyZSIsImNvdXJzZV9zZXJ2aWNlXzEiLCJleGVyY2lzZV9zZXJ2aWNlXzEiLCJwYXRoIiwibW9tZW50IiwibG9nIiwiQW5hbHl0aWNzU2VydmljZSIsImpvaW4iLCJfX2Rpcm5hbWUiLCJCYXNlQ29udHJvbGxlciIsIlBhc3Nwb3J0SGVscGVyIiwiUGF0aEZvcm1hdHRlciIsIkZvcm1hdHRlciIsIlV0aWxzIiwiVEFHIiwiRXhlcmNpc2VDb250cm9sbGVyIiwiW29iamVjdCBPYmplY3RdIiwiaGFzaEFzc2V0Iiwic3ByZWFkIiwicmVzdWx0IiwicmVzdWx0MiIsInJlc3VsdDMiLCJ0aGlzIiwiZXhlcmNpc2VGcm9udGVuZEpTIiwiY29tcGV0ZW5jeUV4ZXJjaXNlTG9naXNjdGljSlMiLCJjb21wZXRlbmN5RXhlcmNpc2VKUyIsImluaXREYXRhIiwic3VwZXIiLCJhbmFseXRpY3NTZXJ2aWNlIiwiZ2V0RGIiLCJzZXF1ZWxpemUiLCJtb2RlbHMiLCJhZGRJbnRlcmNlcHRvciIsInJlcSIsInJlcyIsIm5leHQiLCJyb3V0ZUdldCIsImVuc3VyZUxvZ2dlZEluIiwidXNlcklkIiwidXNlciIsImlkIiwiZXhlcmNpc2VJZCIsInBhcmFtcyIsInN1YnRvcGljSWQiLCJkZWZhdWx0IiwiZ2V0Rm9ybWF0dGVkRXhlcmNpc2UiLCJnZXRSZW5kZXJlZEV4ZXJjaXNlU3RhcnMiLCJnZXRSZW5kZXJlZEV4ZXJjaXNlVGltZXJzIiwiZ2V0UHJldmlvdXNBbmROZXh0RXhlcmNpc2UiLCJnZXRQcmV2aW91c0FuZE5leHRTdWJ0b3BpYyIsImdldFN1YnRvcGljIiwicmVzcDEiLCJyZXNwMiIsInJlc3AzIiwicmVzcDQiLCJyZXNwNSIsInJlc3A2Iiwic3RhdHVzIiwiZGF0YSIsInByZXZBbmROZXh0RXhlcmNpc2UiLCJwcmV2QW5kTmV4dFN1YnRvcGljIiwibG9jYWxzIiwiZm9ybWF0dGVkRXhlcmNpc2UiLCJlbGFwc2VkVGltZSIsImlkZWFsVGltZSIsInByZXZMaW5rIiwicHJldiIsImdldEV4ZXJjaXNlVVJMIiwiZ2V0U3VidG9waWNVUkwiLCJuZXh0TGluayIsInN0YXJzSFRNTCIsInRpbWVyc0hUTUwiLCJzdWJ0b3BpYyIsImJ1bmRsZSIsInJlbmRlciIsIkVycm9yIiwiZXJyTWVzc2FnZSIsImNhdGNoIiwicGFyc2VJbnQiLCJxdWVyeSIsInVuZGVmaW5lZCIsImpzb24iLCJpc0F1dGhlbnRpY2F0ZWQiLCJnZXRFeGVyY2lzZVN0YXJzIiwidGhlbiIsInJlc3AiLCJlcnIiLCJyb3V0ZVBvc3QiLCJib2R5IiwiZ2V0RXhlcmNpc2VMZWFkZXJib2FyZCIsImFuc3dlcnMiLCJjb25zb2xlIiwiZGlyIiwiZmluaXNoRXhlcmNpc2UiLCJncmFkZSIsImF0dGVtcHRzUGVyY2VudGFnZSIsInJlZHVjZSIsImNvdW50IiwiYW5zd2VyIiwiT2JqZWN0IiwidmFsdWVzIiwiYWNjIiwidXNlcklucHV0IiwibGVuZ3RoIiwiYWRkRXhlcmNpc2VTdWJtaXNzaW9uU3RhdHMiLCJzY29yZSIsImVycm9yIiwiSlNPTiIsInN0cmluZ2lmeSIsImdldEN1cnJlbnRSYW5raW5nIiwidGltZUZpbmlzaCIsImdldFRvdGFsUmFua2luZyIsImNvcnJlY3RBbnN3ZXJzIiwiaXNDb3JyZWN0IiwicmFua2luZyIsImN1cnJlbnRSYW5raW5nIiwidG90YWxSYW5raW5nIiwia2V5IiwidmFsdWUiLCJhZGRFeGVyY2lzZURhdGEiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoib0VBQUEsTUFBQUEsUUFBQUMsUUFBQSxZQUNBQyxpQkFBQUQsUUFBQSxpQ0FDQUUsbUJBQUFGLFFBQUEsbUNBS0EsSUFBSUcsS0FBT0gsUUFBUSxRQUVmSSxPQUFTSixRQUFRLG1CQUVqQkssSUFBTUwsUUFBUSxVQUVkTSxpQkFBbUJOLFFBQVFHLEtBQUtJLEtBQUtDLFVBQVcscUNBQ2hE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LEVBQVVMLEVBQUlNLE1BQVFOLEVBQUlNLEtBQUtDLEtBQVEsRUFDdkM4RSxFQUFRckYsRUFBSXVELEtBQUs4QixNQUN2QjFGLEVBQWlCMkYsZ0JBQWdCRixFQUFLQyxFQUFPN0UsRUFBWUgsR0FBUThDLEtBQUtDLElBQ3BFbkQsRUFBSStDLEtBQUtJLEtBQ1JSLE1BQU1TLElBQ1BuRCxFQUFLbUQsUUFNYmtDLE9BQU9DLFFBQVUxRyIsImZpbGUiOiJhcHAvY29udHJvbGxlcnMvZXhlcmNpc2UtY29udHJvbGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFByb21pc2UgZnJvbSAnYmx1ZWJpcmQnXG5pbXBvcnQgQ291cnNlU2VydmljZSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9jb3Vyc2Utc2VydmljZSdcbmltcG9ydCBFeGVyY2lzZVNlcnZpY2UsIHsgRXhlcmNpc2VBbnN3ZXIgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9leGVyY2lzZS1zZXJ2aWNlJ1xuaW1wb3J0IENvbXBldGVuY3lFeGVyY2lzZVNlcnZpY2UgZnJvbSAnLi4vLi4vc2VydmljZXMvY29tcGV0ZW5jeS1leGVyY2lzZS1zZXJ2aWNlJ1xuaW1wb3J0IEV4ZXJjaXNlR2VuZXJhdG9yIGZyb20gJy4uLy4uL2xpYi9leGVyY2lzZV9nZW5lcmF0b3IvZXhlcmNpc2UtZ2VuZXJhdG9yJ1xuaW1wb3J0IEV4ZXJjaXNlSGVscGVyIGZyb20gJy4uL3V0aWxzL2V4ZXJjaXNlLWhlbHBlcidcblxubGV0IHBhdGggPSByZXF1aXJlKCdwYXRoJylcblxubGV0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudC10aW1lem9uZScpXG5cbmxldCBsb2cgPSByZXF1aXJlKCducG1sb2cnKVxuXG5sZXQgQW5hbHl0aWNzU2VydmljZSA9IHJlcXVpcmUocGF0aC5qb2luKF9fZGlybmFtZSwgJy4uLy4uL3NlcnZpY2VzL2FuYWx5dGljcy1zZXJ2aWNlJykpXG5sZXQgQmFzZUNvbnRyb2xsZXIgPSByZXF1aXJlKHBhdGguam9pbihfX2Rpcm5hbWUsICdiYXNlLWNvbnRyb2xsZXInKSlcbmxldCBQYXNzcG9ydEhlbHBlciA9IHJlcXVpcmUocGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL3V0aWxzL3Bhc3Nwb3J0LWhlbHBlcicpKVxubGV0IFBhdGhGb3JtYXR0ZXIgPSByZXF1aXJlKHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi8uLi9saWIvcGF0aC1mb3JtYXR0ZXInKSlcblxubGV0IEZvcm1hdHRlciA9IHJlcXVpcmUocGF0aC5qb2luKF9fZGlybmFtZSwgJy4uLy4uL2xpYi91dGlscy9mb3JtYXR0ZXInKSlcbmxldCBVdGlscyA9IHJlcXVpcmUocGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL3V0aWxzL3V0aWxzJykpXG5cbmNvbnN0IFRBRyA9ICdFeGVyY2lzZUNvbnRyb2xsZXInXG5cbmNsYXNzIEV4ZXJjaXNlQ29udHJvbGxlciBleHRlbmRzIEJhc2VDb250cm9sbGVyIHtcbiAgcHJpdmF0ZSBleGVyY2lzZUZyb250ZW5kSlM6IHN0cmluZ1xuICBwcml2YXRlIGNvbXBldGVuY3lFeGVyY2lzZUxvZ2lzY3RpY0pTOiBzdHJpbmdcbiAgcHJpdmF0ZSBjb21wZXRlbmN5RXhlcmNpc2VKUzogc3RyaW5nXG5cbiAgaW5pdGlhbGl6ZSAoKSB7XG4gICAgcmV0dXJuIFByb21pc2Uuam9pbihcbiAgICAgIFBhdGhGb3JtYXR0ZXIuaGFzaEFzc2V0KCdhcHAnLCAnL2Fzc2V0cy9qcy9leGVyY2lzZS1hcHAtYnVuZGxlLmpzJyksXG4gICAgICBQYXRoRm9ybWF0dGVyLmhhc2hBc3NldCgnYXBwJywgJy9hc3NldHMvanMvY29tcGV0ZW5jeS1leGVyY2lzZS1sb2dpc3RpYy1hcHAtYnVuZGxlLmpzJyksXG4gICAgICBQYXRoRm9ybWF0dGVyLmhhc2hBc3NldCgnYXBwJywgJy9hc3NldHMvanMvY29tcGV0ZW5jeS1leGVyY2lzZS1hcHAtYnVuZGxlLmpzJylcbiAgICApLnNwcmVhZCgocmVzdWx0OiBzdHJpbmcsIHJlc3VsdDI6IHN0cmluZywgcmVzdWx0Mzogc3RyaW5nKSA9PiB7XG4gICAgICB0aGlzLmV4ZXJjaXNlRnJvbnRlbmRKUyA9IHJlc3VsdFxuICAgICAgdGhpcy5jb21wZXRlbmN5RXhlcmNpc2VMb2dpc2N0aWNKUyA9IHJlc3VsdDJcbiAgICAgIHRoaXMuY29tcGV0ZW5jeUV4ZXJjaXNlSlMgPSByZXN1bHQzXG4gICAgfSlcbiAgfVxuXG4gIGNvbnN0cnVjdG9yIChpbml0RGF0YSkge1xuICAgIHN1cGVyKGluaXREYXRhKVxuICAgIGNvbnN0IGFuYWx5dGljc1NlcnZpY2UgPSBuZXcgQW5hbHl0aWNzU2VydmljZSh0aGlzLmdldERiKCkuc2VxdWVsaXplLCB0aGlzLmdldERiKCkubW9kZWxzKVxuICAgIHRoaXMuYWRkSW50ZXJjZXB0b3IoKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICBuZXh0KClcbiAgICB9KVxuXG4gICAgLy8gQ29udGludWUvc3RhcnQgYW4gZXhlcmNpc2VcbiAgICB0aGlzLnJvdXRlR2V0KCcvOnRvcGljSWQvOnRvcGljU2x1Zy86c3VidG9waWNJZC86c3VidG9waWNTbHVnLzpleGVyY2lzZUlkLzpleGVyY2lzZVNsdWcnLCBQYXNzcG9ydEhlbHBlci5lbnN1cmVMb2dnZWRJbigpLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyLmlkXG4gICAgICBjb25zdCBleGVyY2lzZUlkID0gcmVxLnBhcmFtcy5leGVyY2lzZUlkXG4gICAgICBjb25zdCBzdWJ0b3BpY0lkID0gcmVxLnBhcmFtcy5zdWJ0b3BpY0lkXG5cbiAgICAgIFByb21pc2Uuam9pbjxhbnk+KFxuICAgICAgICBFeGVyY2lzZVNlcnZpY2UuZ2V0Rm9ybWF0dGVkRXhlcmNpc2UoZXhlcmNpc2VJZCwgdXNlcklkKSxcbiAgICAgICAgRXhlcmNpc2VTZXJ2aWNlLmdldFJlbmRlcmVkRXhlcmNpc2VTdGFycyh1c2VySWQsIGV4ZXJjaXNlSWQpLFxuICAgICAgICBFeGVyY2lzZVNlcnZpY2UuZ2V0UmVuZGVyZWRFeGVyY2lzZVRpbWVycyh1c2VySWQsIGV4ZXJjaXNlSWQpLFxuICAgICAgICBDb3Vyc2VTZXJ2aWNlLmdldFByZXZpb3VzQW5kTmV4dEV4ZXJjaXNlKHN1YnRvcGljSWQsIGV4ZXJjaXNlSWQpLFxuICAgICAgICBDb3Vyc2VTZXJ2aWNlLmdldFByZXZpb3VzQW5kTmV4dFN1YnRvcGljKHN1YnRvcGljSWQpLFxuICAgICAgICBDb3Vyc2VTZXJ2aWNlLmdldFN1YnRvcGljKHN1YnRvcGljSWQpXG4gICAgICApLnNwcmVhZCgocmVzcDE6IE5DUmVzcG9uc2U8Rm9ybWF0dGVkU3VidG9waWNFeGVyY2lzZT4sXG4gICAgICAgICAgICAgICAgcmVzcDI6IE5DUmVzcG9uc2U8c3RyaW5nPixcbiAgICAgICAgICAgICAgICByZXNwMzogTkNSZXNwb25zZTxzdHJpbmc+LFxuICAgICAgICAgICAgICAgIHJlc3A0OiBOQ1Jlc3BvbnNlPHsgbmV4dD86IEV4ZXJjaXNlLCBwcmV2PzogRXhlcmNpc2V9PixcbiAgICAgICAgICAgICAgICByZXNwNTogTkNSZXNwb25zZTx7IG5leHQ/OiBTdWJ0b3BpYywgcHJldj86IFN1YnRvcGljfT4sXG4gICAgICAgICAgICAgICAgcmVzcDY6IE5DUmVzcG9uc2U8U3VidG9waWM+KSA9PiB7XG4gICAgICAgIGlmIChyZXNwMS5zdGF0dXMgJiYgcmVzcDEuZGF0YSAmJlxuICAgICAgICAgICAgcmVzcDQuc3RhdHVzICYmIHJlc3A0LmRhdGEgJiZcbiAgICAgICAgICAgIHJlc3A1LnN0YXR1cyAmJiByZXNwNS5kYXRhICYmXG4gICAgICAgICAgICByZXNwNi5zdGF0dXMgJiYgcmVzcDYuZGF0YSkge1xuICAgICAgICAgIGNvbnN0IHByZXZBbmROZXh0RXhlcmNpc2UgPSByZXNwNC5kYXRhXG4gICAgICAgICAgY29uc3QgcHJldkFuZE5leHRTdWJ0b3BpYyA9IHJlc3A1LmRhdGFcbiAgICAgICAgICByZXMubG9jYWxzLmZvcm1hdHRlZEV4ZXJjaXNlID0gcmVzcDEuZGF0YS5mb3JtYXR0ZWRFeGVyY2lzZVxuICAgICAgICAgIHJlcy5sb2NhbHMuZWxhcHNlZFRpbWUgPSByZXNwMS5kYXRhLmVsYXBzZWRUaW1lXG4gICAgICAgICAgcmVzLmxvY2Fscy5pZGVhbFRpbWUgPSByZXNwMS5kYXRhLmlkZWFsVGltZVxuICAgICAgICAgIHJlcy5sb2NhbHMuZXhlcmNpc2VJZCA9IHJlc3AxLmRhdGEuZXhlcmNpc2VJZFxuICAgICAgICAgIHJlcy5sb2NhbHMucHJldkxpbmsgPSBwcmV2QW5kTmV4dEV4ZXJjaXNlICYmIHByZXZBbmROZXh0RXhlcmNpc2UucHJldlxuICAgICAgICAgICAgICA/IEZvcm1hdHRlci5nZXRFeGVyY2lzZVVSTChwcmV2QW5kTmV4dEV4ZXJjaXNlLnByZXYpXG4gICAgICAgICAgICAgIDogKHByZXZBbmROZXh0U3VidG9waWMgJiYgcHJldkFuZE5leHRTdWJ0b3BpYy5wcmV2ID9cbiAgICAgICAgICAgICAgICAgICAgRm9ybWF0dGVyLmdldFN1YnRvcGljVVJMKHByZXZBbmROZXh0U3VidG9waWMucHJldikgOiBudWxsKVxuICAgICAgICAgIHJlcy5sb2NhbHMubmV4dExpbmsgPSBwcmV2QW5kTmV4dEV4ZXJjaXNlICYmIHByZXZBbmROZXh0RXhlcmNpc2UubmV4dFxuICAgICAgICAgICAgICA/IEZvcm1hdHRlci5nZXRFeGVyY2lzZVVSTChwcmV2QW5kTmV4dEV4ZXJjaXNlLm5leHQpXG4gICAgICAgICAgICAgIDogKHByZXZBbmROZXh0U3VidG9waWMgJiYgcHJldkFuZE5leHRTdWJ0b3BpYy5uZXh0ID9cbiAgICAgICAgICAgICAgICAgICAgRm9ybWF0dGVyLmdldFN1YnRvcGljVVJMKHByZXZBbmROZXh0U3VidG9waWMubmV4dCkgOiBudWxsKVxuICAgICAgICAgIHJlcy5sb2NhbHMuc3RhcnNIVE1MID0gcmVzcDIuc3RhdHVzID8gcmVzcDIuZGF0YSA6ICc8cCBzdHlsZT1cImNvbG9yOnJlZDtcIj4gVW5hYmxlIHRvIHJldHJpZXZlIHN0YXJzLi4uIDwvcD4nXG4gICAgICAgICAgcmVzLmxvY2Fscy50aW1lcnNIVE1MID0gcmVzcDMuc3RhdHVzID8gcmVzcDMuZGF0YSA6ICc8cCBzdHlsZT1cImNvbG9yOnJlZDtcIj4gVW5hYmxlIHRvIHJldHJpZXZlIHRpbWVycy4uLiA8L3A+J1xuICAgICAgICAgIHJlcy5sb2NhbHMuc3VidG9waWMgPSByZXNwNi5kYXRhXG5cbiAgICAgICAgICByZXMubG9jYWxzLmJ1bmRsZSA9IHRoaXMuZXhlcmNpc2VGcm9udGVuZEpTXG4gICAgICAgICAgcmVzLnJlbmRlcignZXhlcmNpc2UnKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5leHQobmV3IEVycm9yKHJlc3AxLmVyck1lc3NhZ2UgfHwgcmVzcDQuZXJyTWVzc2FnZSB8fCByZXNwNS5lcnJNZXNzYWdlIHx8IHJlc3A2LmVyck1lc3NhZ2UpKVxuICAgICAgICB9XG4gICAgICB9KS5jYXRjaChuZXh0KVxuICAgIH0pXG5cbiAgICB0aGlzLnJvdXRlR2V0KCcvZ2V0RXhlcmNpc2VTdGFycycsIFBhc3Nwb3J0SGVscGVyLmVuc3VyZUxvZ2dlZEluKCksIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgY29uc3QgZXhlcmNpc2VJZCA9IHBhcnNlSW50KHJlcS5xdWVyeS5leGVyY2lzZUlkLCAxMClcbiAgICAgIGlmIChleGVyY2lzZUlkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmVzLmpzb24oeyBzdGF0dXM6IGZhbHNlLCBlcnJNZXNzYWdlOiBgZXhlcmNpc2VJZCBpcyBuZWVkZWRgIH0pXG4gICAgICB9IGVsc2UgaWYgKCFyZXEuaXNBdXRoZW50aWNhdGVkKSB7XG4gICAgICAgIHJlcy5qc29uKHsgc3RhdHVzOiBmYWxzZSwgZXJyTWVzc2FnZTogYFVuYXV0aG9yaXplZGAgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIHN1YnRvcGljIHN0YXJzXG4gICAgICAgIEV4ZXJjaXNlU2VydmljZS5nZXRFeGVyY2lzZVN0YXJzKHJlcS51c2VyLmlkLCBleGVyY2lzZUlkKS50aGVuKHJlc3AgPT4ge1xuICAgICAgICAgIHJlcy5qc29uKHJlc3ApXG4gICAgICAgIH0pLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgbmV4dChlcnIpXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSlcblxuICAgIHRoaXMucm91dGVQb3N0KCcvZXhlcmNpc2UvZ2V0TGVhZGVyYm9hcmQnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIGNvbnN0IGV4ZXJjaXNlSWQgPSBwYXJzZUludChyZXEuYm9keS5leGVyY2lzZUlkLCAxMClcbiAgICAgIGlmIChleGVyY2lzZUlkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmVzLmpzb24oeyBzdGF0dXM6IGZhbHNlLCBlcnJNZXNzYWdlOiBgZXhlcmNpc2VJZCBpcyBuZWVkZWRgIH0pXG4gICAgICB9IGVsc2UgaWYgKCFyZXEuaXNBdXRoZW50aWNhdGVkKSB7XG4gICAgICAgIHJlcy5qc29uKHsgc3RhdHVzOiBmYWxzZSwgZXJyTWVzc2FnZTogYFVuYXV0aG9yaXplZGAgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIEV4ZXJjaXNlU2VydmljZS5nZXRFeGVyY2lzZUxlYWRlcmJvYXJkKGV4ZXJjaXNlSWQpLnRoZW4ocmVzcCA9PiB7XG4gICAgICAgICAgcmVzLmpzb24ocmVzcClcbiAgICAgICAgfSkuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICBuZXh0KGVycilcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgLy8gRXhlcmNpc2Ugc3VibWlzc2lvblxuICAgIHRoaXMucm91dGVQb3N0KFxuICAgICAgJy86dG9waWNJZC86dG9waWNTbHVnLzpzdWJ0b3BpY0lkLzpzdWJ0b3BpY1NsdWcvOmV4ZXJjaXNlSWQvOmV4ZXJjaXNlU2x1ZycsXG4gICAgICBQYXNzcG9ydEhlbHBlci5lbnN1cmVMb2dnZWRJbigpLFxuICAgICAgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyLmlkXG4gICAgICAgIGNvbnN0IGV4ZXJjaXNlSWQgPSByZXEuYm9keS5leGVyY2lzZUlkXG4gICAgICAgIGNvbnN0IGFuc3dlcnM6IEV4ZXJjaXNlQW5zd2VyID0gcmVxLmJvZHkuYW5zd2Vyc1xuICAgICAgICBjb25zb2xlLmRpcihyZXEuYm9keSlcbiAgICAgICAgRXhlcmNpc2VTZXJ2aWNlLmZpbmlzaEV4ZXJjaXNlKGV4ZXJjaXNlSWQsIHVzZXJJZCwgYW5zd2VycykudGhlbihyZXNwID0+IHtcbiAgICAgICAgICBpZiAocmVzLnN0YXR1cyAmJiByZXNwLmRhdGEpIHtcbiAgICAgICAgICAgIGNvbnN0IGdyYWRlID0gcmVzcC5kYXRhXG5cbiAgICAgICAgICAgIC8vIERvZXMgdGhlIHN0dWRlbnQgZXZlbiB0cnk/XG4gICAgICAgICAgICBjb25zdCBhdHRlbXB0c1BlcmNlbnRhZ2UgPSBhbnN3ZXJzLnJlZHVjZSgoY291bnQsIGFuc3dlcikgPT4ge1xuICAgICAgICAgICAgICBjb25zdCB1c2VySW5wdXRzID0gT2JqZWN0LnZhbHVlczxzdHJpbmc+KGFuc3dlcilcbiAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIGF0IGxlYXN0IG9uZSBpbnB1dCBpcyBub3QgZW1wdHlcbiAgICAgICAgICAgICAgbGV0IGF0dGVtcHRlZCA9IHVzZXJJbnB1dHMucmVkdWNlKChhY2MsIHVzZXJJbnB1dCkgPT4gYWNjIHx8IHVzZXJJbnB1dC5sZW5ndGggPiAwLCBmYWxzZSlcbiAgICAgICAgICAgICAgcmV0dXJuIGF0dGVtcHRlZCA/IGNvdW50ICsgMSA6IDBcbiAgICAgICAgICAgIH0sIDApIC8gYW5zd2Vycy5sZW5ndGggKiAxMDBcblxuICAgICAgICAgICAgYW5hbHl0aWNzU2VydmljZS5hZGRFeGVyY2lzZVN1Ym1pc3Npb25TdGF0cyhcbiAgICAgICAgICAgICAgZ3JhZGUuc2NvcmUsXG4gICAgICAgICAgICAgIGF0dGVtcHRzUGVyY2VudGFnZSxcbiAgICAgICAgICAgICAgZXhlcmNpc2VJZCxcbiAgICAgICAgICAgICAgdXNlcklkXG4gICAgICAgICAgICApLnRoZW4ocmVzcCA9PiB7XG4gICAgICAgICAgICAgIGlmICghcmVzcC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBsb2cuZXJyb3IoVEFHLCAnc3VibWl0QW5zd2VyLlBPU1QoKTogZmFpbGVkIHRvIGFkZCBhbmFseXRpY3M6ICcgKyBKU09OLnN0cmluZ2lmeShyZXNwKSlcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY2F0Y2goZXJyID0+IGxvZy5lcnJvcihUQUcsIGVycikpXG5cbiAgICAgICAgICAgIC8vIFRPRE86IFRoaXMgc2hvdWxkIGJlIGRvbmUgb24gdGhlIHNlcnZpY2UsIHNvIHRoYXQgd2UgY2FuIHNoYXJlIHR5cGUgZGVmaW5pdGlvbnMgd2l0aFxuICAgICAgICAgICAgLy8gICAgICAgZnJvbnRlbmRcbiAgICAgICAgICAgIFByb21pc2Uuam9pbihcbiAgICAgICAgICAgICAgRXhlcmNpc2VTZXJ2aWNlLmdldFJlbmRlcmVkRXhlcmNpc2VTdGFycyh1c2VySWQsIGV4ZXJjaXNlSWQpLFxuICAgICAgICAgICAgICBFeGVyY2lzZVNlcnZpY2UuZ2V0RXhlcmNpc2VMZWFkZXJib2FyZChleGVyY2lzZUlkKSxcbiAgICAgICAgICAgICAgRXhlcmNpc2VTZXJ2aWNlLmdldEN1cnJlbnRSYW5raW5nKGdyYWRlLnRpbWVGaW5pc2gsIGV4ZXJjaXNlSWQpLFxuICAgICAgICAgICAgICBFeGVyY2lzZVNlcnZpY2UuZ2V0VG90YWxSYW5raW5nKGV4ZXJjaXNlSWQpLFxuICAgICAgICAgICAgICBFeGVyY2lzZVNlcnZpY2UuZ2V0UmVuZGVyZWRFeGVyY2lzZVRpbWVycyh1c2VySWQsIGV4ZXJjaXNlSWQpXG4gICAgICAgICAgICApLnNwcmVhZCgocmVzcDI6IE5DUmVzcG9uc2U8YW55PiwgcmVzcDM6IE5DUmVzcG9uc2U8YW55PixcbiAgICAgICAgICAgICAgICAgICAgICByZXNwNDogTkNSZXNwb25zZTxhbnk+LCByZXNwNTogTkNSZXNwb25zZTxhbnk+LCByZXNwNjogTkNSZXNwb25zZTxhbnk+KSA9PiB7XG4gICAgICAgICAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IHRydWUsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgY29ycmVjdEFuc3dlcnM6IGdyYWRlLmNvcnJlY3RBbnN3ZXJzLFxuICAgICAgICAgICAgICAgICAgaXNDb3JyZWN0OiBncmFkZS5pc0NvcnJlY3QsXG4gICAgICAgICAgICAgICAgICBzY29yZTogZ3JhZGUuc2NvcmUsXG4gICAgICAgICAgICAgICAgICBzdGFyc0hUTUw6IHJlc3AyLmRhdGEsXG4gICAgICAgICAgICAgICAgICB0aW1lcnNIVE1MOiByZXNwNi5kYXRhLFxuICAgICAgICAgICAgICAgICAgcmFua2luZzogcmVzcDMuZGF0YSxcbiAgICAgICAgICAgICAgICAgIHRpbWVGaW5pc2g6IGdyYWRlLnRpbWVGaW5pc2gsXG4gICAgICAgICAgICAgICAgICBjdXJyZW50UmFua2luZzogcmVzcDQuZGF0YS5jb3VudCxcbiAgICAgICAgICAgICAgICAgIHRvdGFsUmFua2luZzogcmVzcDUuZGF0YS5jb3VudFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgfSlcblxuICAgIHRoaXMucm91dGVQb3N0KCcvZXhlcmNpc2UvYW5hbHl0aWNzJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICAvLyBFdmVudCB0eXBlXG4gICAgICBjb25zdCBrZXkgPSByZXEuYm9keS5rZXlcbiAgICAgIGNvbnN0IGV4ZXJjaXNlSWQgPSByZXEuYm9keS5leGVyY2lzZUlkXG4gICAgICBjb25zdCB1c2VySWQgPSAocmVxLnVzZXIgJiYgcmVxLnVzZXIuaWQpIHx8IC0xXG4gICAgICBjb25zdCB2YWx1ZSA9IHJlcS5ib2R5LnZhbHVlXG4gICAgICBhbmFseXRpY3NTZXJ2aWNlLmFkZEV4ZXJjaXNlRGF0YShrZXksIHZhbHVlLCBleGVyY2lzZUlkLCB1c2VySWQpLnRoZW4ocmVzcCA9PiB7XG4gICAgICAgIHJlcy5qc29uKHJlc3ApXG4gICAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgICBuZXh0KGVycilcbiAgICAgIH0pXG4gICAgfSlcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEV4ZXJjaXNlQ29udHJvbGxlclxuIl19
