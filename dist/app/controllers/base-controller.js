const express=require("express"),path=require("path"),fs=require("fs"),log=require("npmlog");var Promise=require("bluebird"),AppConfig=require(path.join(__dirname,"../../app-config"));class BaseController{constructor({site:t,user:e,socketIO:s,db:r,logTag:i}){this._router=express(),this._viewPath=path.join(__dirname,"../views"),this._assetsPath=path.join(this._viewPath,"/assets"),this._db=r,this.getRouter().set("views",this._viewPath),this.getRouter().set("view engine","pug"),this.getRouter().use("/assets",express.static(this._assetsPath,{maxAge:"1h"})),this._interceptors=[]}initialize(){return this._initializeStaticHostRoute(),Promise.resolve()}getDb(){return this._db}isUpToDate(){return Promise.resolve(!0)}getRouter(){return this._router}_fileExists(t){return new Promise((e,s)=>{fs.access(t,fs.constants.F_OK,t=>{e(!t)})})}_initializeStaticHostRoute(){this.routeUse((t,e,s)=>{log.info(this.getTag(),"req.path="+t.path);const r=t.path.indexOf("/");if(log.info(this.getTag(),"firstSlash="+r),-1!==r&&r!==t.path.length-1){const i=t.path.substring(r)+".pug",o=path.resolve(path.join(this._viewPath,i));log.info(this.getTag(),"PrivateHostController: fullPath="+o),this._fileExists(o).then(t=>{t?e.render(o):s()})}else{const t=path.resolve(path.join(this._viewPath,"index.pug"));this._fileExists(t).then(s=>{if(!s)throw new Error;e.render(t)}).catch(()=>{e.status(404).send("Not Found!")})}})}_extendInterceptors(t){return this._interceptors.concat(t)}addInterceptor(t){this._interceptors=this._extendInterceptors(t)}routeGet(t,...e){this._router.get(this.getMountPath(t),this._extendInterceptors(e))}routePost(t,...e){this._router.post(this.getMountPath(t),this._extendInterceptors(e))}routeUse(t,...e){this._router.use(this.getMountPath(t),this._extendInterceptors(e))}getMountPath(t){return t||""}getTag(){return this._logTag}}module.exports=BaseController;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9hcHAvY29udHJvbGxlcnMvYmFzZS1jb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbImV4cHJlc3MiLCJyZXF1aXJlIiwicGF0aCIsImZzIiwibG9nIiwiUHJvbWlzZSIsIkFwcENvbmZpZyIsImpvaW4iLCJfX2Rpcm5hbWUiLCJCYXNlQ29udHJvbGxlciIsIltvYmplY3QgT2JqZWN0XSIsInNpdGUiLCJ1c2VyIiwic29ja2V0SU8iLCJkYiIsImxvZ1RhZyIsInRoaXMiLCJfcm91dGVyIiwiX3ZpZXdQYXRoIiwiX2Fzc2V0c1BhdGgiLCJfZGIiLCJnZXRSb3V0ZXIiLCJzZXQiLCJ1c2UiLCJzdGF0aWMiLCJtYXhBZ2UiLCJfaW50ZXJjZXB0b3JzIiwiX2luaXRpYWxpemVTdGF0aWNIb3N0Um91dGUiLCJyZXNvbHZlIiwicmVqZWN0IiwiYWNjZXNzIiwiY29uc3RhbnRzIiwiRl9PSyIsImVyciIsInJvdXRlVXNlIiwicmVxIiwicmVzIiwibmV4dCIsImluZm8iLCJnZXRUYWciLCJmaXJzdFNsYXNoIiwiaW5kZXhPZiIsImxlbmd0aCIsImFmdGVyU2xhc2giLCJzdWJzdHJpbmciLCJmdWxsUGF0aCIsIl9maWxlRXhpc3RzIiwidGhlbiIsImV4aXN0cyIsInJlbmRlciIsImluZGV4UHVnIiwiZXhpc3QiLCJFcnJvciIsImNhdGNoIiwic3RhdHVzIiwic2VuZCIsImZucyIsImNvbmNhdCIsIl9leHRlbmRJbnRlcmNlcHRvcnMiLCJnZXQiLCJnZXRNb3VudFBhdGgiLCJwb3N0Iiwic3RyUGF0aCIsIl9sb2dUYWciLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxRQUFVQyxRQUFRLFdBQ2xCQyxLQUFPRCxRQUFRLFFBQ2ZFLEdBQUtGLFFBQVEsTUFDYkcsSUFBTUgsUUFBUSxVQUVwQixJQUFJSSxRQUFVSixRQUFRLFlBRWxCSyxVQUFZTCxRQUFRQyxLQUFLSyxLQUFLQyxVQUFXLDJCQUU3Q0MsZUFDRUMsYUFBYUMsS0FBQ0EsRUFBSUMsS0FBRUEsRUFBSUMsU0FBRUEsRUFBUUMsR0FBRUEsRUFBRUMsT0FBRUEsSUFDdENDLEtBQUtDLFFBQVVqQixVQUNmZ0IsS0FBS0UsVUFBWWhCLEtBQUtLLEtBQUtDLFVBQVcsWUFDdENRLEtBQUtHLFlBQWNqQixLQUFLSyxLQUFLUyxLQUFLRSxVQUFXLFdBQzdDRixLQUFLSSxJQUFNTixFQUNYRSxLQUFLSyxZQUFZQyxJQUFJLFFBQVNOLEtBQUtFLFdBQ25DRixLQUFLSyxZQUFZQyxJQUFJLGNBQWUsT0FDcENOLEtBQUtLLFlBQVlFLElBQUksVUFBV3ZCLFFBQVF3QixPQUFPUixLQUFLRyxhQUFjTSxPQUFRLFFBQzFFVCxLQUFLVSxpQkFHUGhCLGFBRUUsT0FEQU0sS0FBS1csNkJBQ0V0QixRQUFRdUIsVUFHakJsQixRQUNFLE9BQU9NLEtBQUtJLElBR2RWLGFBQ0UsT0FBT0wsUUFBUXVCLFNBQVEsR0FHekJsQixZQUNFLE9BQU9NLEtBQUtDLFFBR2RQLFlBQWFSLEdBQ1gsT0FBTyxJQUFJRyxRQUFRLENBQUN1QixFQUFTQyxLQUMzQjFCLEdBQUcyQixPQUFPNUIsRUFBTUMsR0FBRzRCLFVBQVVDLEtBQU1DLElBRS9CTCxHQURFSyxPQVNWdkIsNkJBRUVNLEtBQUtrQixTQUFTLENBQUNDLEVBQUtDLEVBQUtDLEtBQ3ZCakMsSUFBSWtDLEtBQUt0QixLQUFLdUIsU0FBVSxZQUFjSixFQUFJakMsTUFDMUMsTUFBTXNDLEVBQWFMLEVBQUlqQyxLQUFLdUMsUUFBUSxLQUdwQyxHQUZBckMsSUFBSWtDLEtBQUt0QixLQUFLdUIsU0FBVSxjQUFnQkMsSUFFcEIsSUFBaEJBLEdBQXFCQSxJQUFnQkwsRUFBSWpDLEtBQUt3QyxPQUFTLEVBQUksQ0FDN0QsTUFBTUMsRUFBYVIsRUFBSWpDLEtBQUswQyxVQUFVSixHQUFjLE9BQzlDSyxFQUFXM0MsS0FBSzBCLFFBQVExQixLQUFLSyxLQUFLUyxLQUFLRSxVQUFXeUIsSUFDeER2QyxJQUFJa0MsS0FBS3RCLEtBQUt1QixTQUFVLG1DQUFxQ00sR0FDN0Q3QixLQUFLOEIsWUFBWUQsR0FBVUUsS0FBS0MsSUFDMUJBLEVBQ0ZaLEVBQUlhLE9BQU9KLEdBR1hSLFVBR0MsQ0FDTCxNQUFNYSxFQUFXaEQsS0FBSzBCLFFBQVExQixLQUFLSyxLQUFLUyxLQUFLRSxVQUFXLGNBQ3hERixLQUFLOEIsWUFBWUksR0FBVUgsS0FBS0ksSUFDOUIsSUFBSUEsRUFHRixNQUFNLElBQUlDLE1BRlZoQixFQUFJYSxPQUFPQyxLQUlaRyxNQUFNLEtBQ1BqQixFQUFJa0IsT0FBTyxLQUFLQyxLQUFLLG1CQU03QjdDLG9CQUFxQjhDLEdBQ25CLE9BQU94QyxLQUFLVSxjQUFjK0IsT0FBT0QsR0FLbkM5QyxlQUFnQjhDLEdBRWR4QyxLQUFLVSxjQUFnQlYsS0FBSzBDLG9CQUFvQkYsR0FHaEQ5QyxTQUFVUixLQUFTc0QsR0FDakJ4QyxLQUFLQyxRQUFRMEMsSUFBSTNDLEtBQUs0QyxhQUFhMUQsR0FBT2MsS0FBSzBDLG9CQUFvQkYsSUFHckU5QyxVQUFXUixLQUFTc0QsR0FDbEJ4QyxLQUFLQyxRQUFRNEMsS0FBSzdDLEtBQUs0QyxhQUFhMUQsR0FBT2MsS0FBSzBDLG9CQUFvQkYsSUFHdEU5QyxTQUFVUixLQUFTc0QsR0FDakJ4QyxLQUFLQyxRQUFRTSxJQUFJUCxLQUFLNEMsYUFBYTFELEdBQU9jLEtBQUswQyxvQkFBb0JGLElBR3JFOUMsYUFBY29ELEdBQ1osT0FBT0EsR0FBVyxHQUdwQnBELFNBQ0UsT0FBT00sS0FBSytDLFNBSWhCQyxPQUFPQyxRQUFVeEQiLCJmaWxlIjoiYXBwL2NvbnRyb2xsZXJzL2Jhc2UtY29udHJvbGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJylcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJylcbmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKVxuY29uc3QgbG9nID0gcmVxdWlyZSgnbnBtbG9nJylcblxudmFyIFByb21pc2UgPSByZXF1aXJlKCdibHVlYmlyZCcpXG5cbnZhciBBcHBDb25maWcgPSByZXF1aXJlKHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi8uLi9hcHAtY29uZmlnJykpXG5cbmNsYXNzIEJhc2VDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IgKHtzaXRlLCB1c2VyLCBzb2NrZXRJTywgZGIsIGxvZ1RhZ30pIHtcbiAgICB0aGlzLl9yb3V0ZXIgPSBleHByZXNzKClcbiAgICB0aGlzLl92aWV3UGF0aCA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi92aWV3cycpXG4gICAgdGhpcy5fYXNzZXRzUGF0aCA9IHBhdGguam9pbih0aGlzLl92aWV3UGF0aCwgJy9hc3NldHMnKVxuICAgIHRoaXMuX2RiID0gZGJcbiAgICB0aGlzLmdldFJvdXRlcigpLnNldCgndmlld3MnLCB0aGlzLl92aWV3UGF0aClcbiAgICB0aGlzLmdldFJvdXRlcigpLnNldCgndmlldyBlbmdpbmUnLCAncHVnJylcbiAgICB0aGlzLmdldFJvdXRlcigpLnVzZSgnL2Fzc2V0cycsIGV4cHJlc3Muc3RhdGljKHRoaXMuX2Fzc2V0c1BhdGgsIHttYXhBZ2U6ICcxaCd9KSlcbiAgICB0aGlzLl9pbnRlcmNlcHRvcnMgPSBbXVxuICB9XG5cbiAgaW5pdGlhbGl6ZSAoKSB7XG4gICAgdGhpcy5faW5pdGlhbGl6ZVN0YXRpY0hvc3RSb3V0ZSgpXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpXG4gIH1cblxuICBnZXREYiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2RiXG4gIH1cblxuICBpc1VwVG9EYXRlICgpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRydWUpXG4gIH1cblxuICBnZXRSb3V0ZXIgKCkge1xuICAgIHJldHVybiB0aGlzLl9yb3V0ZXJcbiAgfVxuXG4gIF9maWxlRXhpc3RzIChwYXRoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGZzLmFjY2VzcyhwYXRoLCBmcy5jb25zdGFudHMuRl9PSywgZXJyID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJlc29sdmUoZmFsc2UpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZSh0cnVlKVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0pXG4gIH1cblxuICBfaW5pdGlhbGl6ZVN0YXRpY0hvc3RSb3V0ZSAoKSB7XG4gICAgLy8gV2hlbiB0aGUgc3BlY2lmaWVkIHBhdGggaXNuJ3Qgc2VydmVyYWJsZSBzdGF0aWMgZmlsZSwgYXNzdW1lIGl0J3MgcHVnXG4gICAgdGhpcy5yb3V0ZVVzZSgocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIGxvZy5pbmZvKHRoaXMuZ2V0VGFnKCksICdyZXEucGF0aD0nICsgcmVxLnBhdGgpXG4gICAgICBjb25zdCBmaXJzdFNsYXNoID0gcmVxLnBhdGguaW5kZXhPZignLycpXG4gICAgICBsb2cuaW5mbyh0aGlzLmdldFRhZygpLCAnZmlyc3RTbGFzaD0nICsgZmlyc3RTbGFzaClcbiAgICAgIC8vIFRoZSBwYXRoIGlzbid0IHd3dy5kb21haW4uY29tIG9yIHd3dy5kb21haW4uY29tLywgYnV0IHd3dy5kb21haW4uY29tL2hlaGVoXG4gICAgICBpZiAoZmlyc3RTbGFzaCAhPT0gLTEgJiYgZmlyc3RTbGFzaCAhPT0gKHJlcS5wYXRoLmxlbmd0aCAtIDEpKSB7XG4gICAgICAgIGNvbnN0IGFmdGVyU2xhc2ggPSByZXEucGF0aC5zdWJzdHJpbmcoZmlyc3RTbGFzaCkgKyAnLnB1ZydcbiAgICAgICAgY29uc3QgZnVsbFBhdGggPSBwYXRoLnJlc29sdmUocGF0aC5qb2luKHRoaXMuX3ZpZXdQYXRoLCBhZnRlclNsYXNoKSlcbiAgICAgICAgbG9nLmluZm8odGhpcy5nZXRUYWcoKSwgJ1ByaXZhdGVIb3N0Q29udHJvbGxlcjogZnVsbFBhdGg9JyArIGZ1bGxQYXRoKVxuICAgICAgICB0aGlzLl9maWxlRXhpc3RzKGZ1bGxQYXRoKS50aGVuKGV4aXN0cyA9PiB7XG4gICAgICAgICAgaWYgKGV4aXN0cykge1xuICAgICAgICAgICAgcmVzLnJlbmRlcihmdWxsUGF0aClcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gV2hlbiB0aGVyZSBpcyBubyBtYXRjaGluZyBwdWcgdGVtcGxhdGUgZmlsZSwgZm9yd2FyZCB0aGUgcmVxdWVzdCB0byB0aGUgbmV4dCBtaWRkbGV3YXJlXG4gICAgICAgICAgICBuZXh0KClcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9IGVsc2UgeyAvLyBXaGVuIG5vIHBhdGggaXMgZ2l2ZW4sIHRyeSB0byByZW5kZXIgaW5kZXgucHVnXG4gICAgICAgIGNvbnN0IGluZGV4UHVnID0gcGF0aC5yZXNvbHZlKHBhdGguam9pbih0aGlzLl92aWV3UGF0aCwgJ2luZGV4LnB1ZycpKVxuICAgICAgICB0aGlzLl9maWxlRXhpc3RzKGluZGV4UHVnKS50aGVuKGV4aXN0ID0+IHtcbiAgICAgICAgICBpZiAoZXhpc3QpIHtcbiAgICAgICAgICAgIHJlcy5yZW5kZXIoaW5kZXhQdWcpXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigpXG4gICAgICAgICAgfVxuICAgICAgICB9KS5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgcmVzLnN0YXR1cyg0MDQpLnNlbmQoJ05vdCBGb3VuZCEnKVxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICBfZXh0ZW5kSW50ZXJjZXB0b3JzIChmbnMpIHtcbiAgICByZXR1cm4gdGhpcy5faW50ZXJjZXB0b3JzLmNvbmNhdChmbnMpXG4gIH1cblxuICAvLyBmbjogRXhwcmVzcyByb3V0ZSBmdW5jdGlvbiAoaS5lLiAocmVxLCByZXMsIG5leHQpID0+IC4uLilcbiAgLy8gICAgIHdoaWNoIHdpbGwgYmUgY2FsbGVkIGJlZm9yZSBhbnkgb2YgR0VUL1BPU1QgZGVmaW5lZCBpbiB0aGUgY2xhc3MgaXMgY2FsbGVkLlxuICBhZGRJbnRlcmNlcHRvciAoZm5zKSB7XG4gICAgLy8gbG9nLnZlcmJvc2UodGhpcy5nZXRUYWcoKSwgJ2FkZEludGVyY2VwdG9yKCk6IHRoaXMuX2ludGVyY2VwdG9ycy5sZW5ndGg9JyArIHRoaXMuX2ludGVyY2VwdG9ycy5sZW5ndGgpXG4gICAgdGhpcy5faW50ZXJjZXB0b3JzID0gdGhpcy5fZXh0ZW5kSW50ZXJjZXB0b3JzKGZucylcbiAgfVxuXG4gIHJvdXRlR2V0IChwYXRoLCAuLi5mbnMpIHtcbiAgICB0aGlzLl9yb3V0ZXIuZ2V0KHRoaXMuZ2V0TW91bnRQYXRoKHBhdGgpLCB0aGlzLl9leHRlbmRJbnRlcmNlcHRvcnMoZm5zKSlcbiAgfVxuXG4gIHJvdXRlUG9zdCAocGF0aCwgLi4uZm5zKSB7XG4gICAgdGhpcy5fcm91dGVyLnBvc3QodGhpcy5nZXRNb3VudFBhdGgocGF0aCksIHRoaXMuX2V4dGVuZEludGVyY2VwdG9ycyhmbnMpKVxuICB9XG5cbiAgcm91dGVVc2UgKHBhdGgsIC4uLmZucykge1xuICAgIHRoaXMuX3JvdXRlci51c2UodGhpcy5nZXRNb3VudFBhdGgocGF0aCksIHRoaXMuX2V4dGVuZEludGVyY2VwdG9ycyhmbnMpKVxuICB9XG5cbiAgZ2V0TW91bnRQYXRoIChzdHJQYXRoKSB7XG4gICAgcmV0dXJuIHN0clBhdGggfHwgJydcbiAgfVxuXG4gIGdldFRhZyAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xvZ1RhZ1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gQmFzZUNvbnRyb2xsZXJcbiJdfQ==
