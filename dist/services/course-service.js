"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const Promise=require("bluebird"),path=require("path"),crud_service_neo_1=require("./crud-service-neo"),Formatter=require(path.join(__dirname,"../lib/utils/formatter"));let log=require("npmlog"),Sequelize=require("sequelize");const TAG="CourseService";class CourseService extends crud_service_neo_1.default{getTopicDetails(e=-1){return super.rawReadQuery(`\nSELECT\n  topics.id AS \`topics.id\`, topics.topicNo AS \`topics.topicNo\`, topics.topic AS \`topics.topic\`,\n  IFNULL(starBadge.\`count\`, 0) AS \`topics.starBadge\`,\n  IFNULL(timeBadge.\`count\`, 0) AS \`topics.timeBadge\`,\n  subtopicsView.id AS \`topics.subtopics.id\`, subtopicsView.subtopicNo AS \`topics.subtopics.subtopicNo\`,\n  subtopicsView.subtopic AS \`topics.subtopics.subtopic\`,\n  IFNULL(subtopicsView.starBadge, 0) AS \`topics.subtopics.starBadge\`,\n  IFNULL(subtopicsView.timeBadge, 0) AS \`topics.subtopics.timeBadge\`,\n  IFNULL(subtopicsView.watchBadge, 0) AS \`topics.subtopics.watchBadge\`\nFROM topics\nLEFT OUTER JOIN (\n  SELECT COUNT(*) AS count, topicId\n  FROM generatedTopicExercises\n  WHERE userId = ${e} AND submitted = 1 AND score >= 80\n  GROUP BY topicId\n) AS starBadge ON starBadge.topicId = topics.id\nLEFT OUTER JOIN (\n  SELECT COUNT(*) AS count, topicId\n  FROM generatedTopicExercises\n  WHERE submitted = 1 AND userId = ${e} AND timeFinish < idealTime AND score = 100\n  GROUP BY topicId\n) AS timeBadge ON timeBadge.topicId = topics.id\nINNER JOIN (\n  SELECT\n    subtopics.id AS id, subtopics.topicId AS topicId, subtopics.subtopic AS subtopic, subtopics.subtopicNo AS subtopicNo,\n    (starBadge.\`count\` / exercisesView.count) AS starBadge,\n    (timeBadge.\`count\` / exercisesView.count) AS timeBadge,\n    watchBadge.\`count\` AS watchBadge\n  FROM subtopics\n  LEFT OUTER JOIN (\n    SELECT\n      exercises.subtopicId AS subtopicId,\n      COUNT(*) AS count,\n      COUNT(distinct exercises.id) AS test\n    FROM generatedExercises\n    INNER JOIN exercises ON exercises.id = generatedExercises.exerciseId\n        AND generatedExercises.submitted = 1 AND generatedExercises.score >= 80\n        AND generatedExercises.userId = ${e}\n    GROUP BY exercises.subtopicId, generatedExercises.userId\n  ) AS starBadge ON starBadge.subtopicId = subtopics.id\n  LEFT OUTER JOIN (\n    SELECT\n      exercises.subtopicId AS subtopicId,\n      COUNT(*) AS count\n    FROM generatedExercises\n    INNER JOIN exercises ON exercises.id = generatedExercises.exerciseId\n        AND generatedExercises.submitted = 1 AND generatedExercises.score = 100 AND timeFinish < idealTime\n        AND generatedExercises.userId = ${e}\n    GROUP BY exercises.subtopicId, generatedExercises.userId\n  ) AS timeBadge ON timeBadge.subtopicId = subtopics.id\n  LEFT OUTER JOIN (\n    SELECT videos.subtopicId AS subtopicId, 1 AS count\n    FROM videos\n    INNER JOIN watchedVideos on watchedVideos.videoId = videos.id AND watchedVideos.userId = ${e}\n    LIMIT 1\n  ) AS watchBadge ON watchBadge.subtopicId = subtopics.id\n  LEFT OUTER JOIN (\n    SELECT subtopicId, COUNT(id) AS count\n    FROM exercises\n    GROUP BY subtopicId\n  ) AS exercisesView ON exercisesView.subtopicId = subtopics.id\n) AS subtopicsView ON subtopicsView.topicId = topics.id\nORDER BY topicNo, subtopicNo ASC\n`).then(e=>e.status?{status:!0,data:Formatter.objectify(e.data)[0]}:{status:!1,errMessage:e.errMessage})}getAllTopics(){return this.getModels("Topic").findAll({order:[["topicNo","ASC"]]}).then(e=>({status:!0,data:e}))}getAllSubtopics(){return this.getModels("Subtopic").findAll({order:[["subtopicNo","ASC"]]}).then(e=>({status:!0,data:e}))}getTopicDependencies(e){return this.getSequelize().query(`SELECT topicDependencies.id, topicDependencies.description, topicDependencies.updatedAt, topics.topic as dependencyName FROM topicDependencies INNER JOIN topics ON topics.id = topicDependencies.dependencyId WHERE topicDependencies.topicId=${e}`,{type:Sequelize.QueryTypes.SELECT}).then(e=>({status:!0,data:e}))}addTopicDependency(e,t,s){return this.read({modelName:"Topic",searchClause:{topic:t}}).then(i=>{if(i.status&&i.data){const t=i.data[0];return t.id===parseInt(e,10)?{status:!1,errMessage:"A topic could not depend on itself!"}:this.create({modelName:"TopicDependency",data:{topicId:e,dependencyId:t.id,description:s}})}return{status:!1,errMessage:`Could not find topic with name "${t}"`}})}getSubtopicByTopicId(e){return this.getModels("Subtopic").findAll({where:{topicId:e},order:[["subtopicNo","ASC"]]}).then(e=>({status:!0,data:e}))}getExerciseBySubtopicId(e){return this.getModels("Exercise").findAll({where:{subtopicId:e},order:[["id","ASC"]]}).then(e=>({status:!0,data:e}))}getSubtopic(e){return this.readOne({modelName:"Subtopic",searchClause:{id:e},include:[{model:this.getModels("Topic")}]})}getOrderedTopics(){return this.read({modelName:"Topic",order:[["topicNo","ASC"]],searchClause:{}})}getTopic(e){return this.readOne({modelName:"Topic",searchClause:{id:e}})}getExercises(e){return this.read({modelName:"Exercise",searchClause:{subtopicId:e},order:[["id","ASC"]]})}getPreviousAndNextExercise(e,t){return Promise.join(this.readOne({modelName:"Exercise",searchClause:{[Sequelize.Op.and]:{id:{[Sequelize.Op.lt]:t},subtopicId:e}},order:[["id","DESC"]],include:[{model:this.getModels("Subtopic"),include:[{model:this.getModels("Topic")}]}]}),this.readOne({modelName:"Exercise",searchClause:{[Sequelize.Op.and]:{id:{[Sequelize.Op.gt]:t},subtopicId:e}},order:[["id","ASC"]],include:[{model:this.getModels("Subtopic"),include:[{model:this.getModels("Topic")}]}]})).spread((e,t)=>({status:!0,data:{prev:e.data,next:t.data}}))}getPreviousAndNextSubtopic(e){return this.getSubtopic(e).then(e=>{if(e.status&&e.data){const t=e.data.subtopicNo;return Promise.join(this.readOne({modelName:"Subtopic",searchClause:{subtopicNo:{[Sequelize.Op.lt]:t}},include:[{model:this.getModels("Topic")}],order:[["subtopicNo","DESC"]]}),this.readOne({modelName:"Subtopic",searchClause:{subtopicNo:{[Sequelize.Op.gt]:t}},include:[{model:this.getModels("Topic")}],order:[["subtopicNo","ASC"]]})).spread((e,t)=>({status:!0,data:{prev:e.data,next:t.data}}))}return{status:!1,errMessage:e.errMessage}})}isSubtopicVideoWatched(e,t){return this.getSequelize().query(`\n  SELECT subtopics.id AS subtopicId, true AS watched\n   FROM subtopics\n   INNER JOIN videos ON videos.subtopicId = subtopics.id\n   INNER JOIN watchedVideos on watchedVideos.videoId = videos.id\n   WHERE subtopics.id = ${e} AND watchedVideos.userId = ${t}\n   LIMIT 1;\n`,{type:this.getSequelize().QueryTypes.SELECT}).then(e=>{let t=!1;return e.length>0&&(t=!0),{status:!0,data:{watched:t}}})}}exports.default=new CourseService;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zZXJ2aWNlcy9jb3Vyc2Utc2VydmljZS50cyJdLCJuYW1lcyI6WyJQcm9taXNlIiwicmVxdWlyZSIsInBhdGgiLCJjcnVkX3NlcnZpY2VfbmVvXzEiLCJGb3JtYXR0ZXIiLCJqb2luIiwiX19kaXJuYW1lIiwibG9nIiwiU2VxdWVsaXplIiwiVEFHIiwiQ291cnNlU2VydmljZSIsImRlZmF1bHQiLCJbb2JqZWN0IE9iamVjdF0iLCJ1c2VySWQiLCJzdXBlciIsInJhd1JlYWRRdWVyeSIsInRoZW4iLCJyZXNwIiwic3RhdHVzIiwiZGF0YSIsIm9iamVjdGlmeSIsImVyck1lc3NhZ2UiLCJ0aGlzIiwiZ2V0TW9kZWxzIiwiZmluZEFsbCIsIm9yZGVyIiwidG9waWNJZCIsImdldFNlcXVlbGl6ZSIsInF1ZXJ5IiwidHlwZSIsIlF1ZXJ5VHlwZXMiLCJTRUxFQ1QiLCJkZXBlbmRlbmN5TmFtZSIsImRlc2NyaXB0aW9uIiwicmVhZCIsIm1vZGVsTmFtZSIsInNlYXJjaENsYXVzZSIsInRvcGljIiwiZGVwZW5kZW5jeVRvcGljIiwiaWQiLCJwYXJzZUludCIsImNyZWF0ZSIsImRlcGVuZGVuY3lJZCIsIndoZXJlIiwic3VidG9waWNJZCIsInJlYWRPbmUiLCJpbmNsdWRlIiwibW9kZWwiLCJleGVyY2lzZUlkIiwiT3AiLCJhbmQiLCJsdCIsImd0Iiwic3ByZWFkIiwicmVzcDEiLCJyZXNwMiIsInByZXYiLCJuZXh0IiwiZ2V0U3VidG9waWMiLCJzdWJ0b3BpY05vIiwicmVzcDMiLCJ3YXRjaGVkIiwibGVuZ3RoIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Im9FQUFBLE1BQUFBLFFBQUFDLFFBQUEsWUFDQUMsS0FBQUQsUUFBQSxRQUVBRSxtQkFBQUYsUUFBQSxzQkFFTUcsVUFBWUgsUUFBUUMsS0FBS0csS0FBS0MsVUFBVywyQkFDL0MsSUFBSUMsSUFBTU4sUUFBUSxVQUNkTyxVQUFZUCxRQUFRLGFBSXhCLE1BQU1RLElBQU0sc0JBb0JaQyxzQkFBNEJQ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cUMsS0FBTUYsRUFBTW5DLEtBQ1pzQyxLQUFNRixFQUFNcEMsU0FNdEJQLDJCQUE0QmdDLEdBQzFCLE9BQU90QixLQUFLb0MsWUFBWWQsR0FBWTVCLEtBQUtDLElBQ3ZDLEdBQUlBLEVBQUtDLFFBQVVELEVBQUtFLEtBQU0sQ0FDNUIsTUFBTXdDLEVBQWExQyxFQUFLRSxLQUFLd0MsV0FDN0IsT0FBTzNELFFBQVFLLEtBQ2JpQixLQUFLdUIsU0FDSFYsVUFBVyxXQUNYQyxjQUFnQnVCLFlBQWMvQyxDQUFDSixVQUFVeUMsR0FBR0UsSUFBS1EsSUFDakRiLFVBQVlDLE1BQU96QixLQUFLQyxVQUFVLFdBQ2xDRSxRQUFTLGFBQWMsV0FFekJILEtBQUt1QixTQUNIVixVQUFXLFdBQ1hDLGNBQWdCdUIsWUFBYy9DLENBQUNKLFVBQVV5QyxHQUFHRyxJQUFLTyxJQUNqRGIsVUFBWUMsTUFBT3pCLEtBQUtDLFVBQVUsV0FDbENFLFFBQVMsYUFBYyxXQUV6QjRCLE9BQU8sQ0FBQ0UsRUFBNkJLLE1BQzVCMUMsUUFBUSxFQUFNQyxNQUFRcUMsS0FBTUQsRUFBTXBDLEtBQU1zQyxLQUFNRyxFQUFNekMsU0FHL0QsT0FBU0QsUUFBUSxFQUFPRyxXQUFZSixFQUFLSSxjQVEvQ1QsdUJBQXdCZ0MsRUFBWS9CLEdBQ2xDLE9BQU9TLEtBQUtLLGVBQWVDLHdPQU1MZ0IsZ0NBQXlDL0Isb0JBRTlEZ0IsS0FBTVAsS0FBS0ssZUFBZUcsV0FBV0MsU0FBVWYsS0FBS0csSUFDdkQsSUFBSTBDLEdBQVUsRUFJZCxPQUhJMUMsRUFBSzJDLE9BQVMsSUFDaEJELEdBQVUsSUFFSDNDLFFBQVEsRUFBTUMsTUFBUTBDLFFBQUFBLE9BS2pDRSxRQUFBcEQsUUFBZSxJQUFJRCIsImZpbGUiOiJzZXJ2aWNlcy9jb3Vyc2Utc2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFByb21pc2UgZnJvbSAnYmx1ZWJpcmQnXG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnXG5cbmltcG9ydCBDUlVEU2VydmljZSBmcm9tICcuL2NydWQtc2VydmljZS1uZW8nXG5cbmNvbnN0IEZvcm1hdHRlciA9IHJlcXVpcmUocGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL2xpYi91dGlscy9mb3JtYXR0ZXInKSlcbmxldCBsb2cgPSByZXF1aXJlKCducG1sb2cnKVxubGV0IFNlcXVlbGl6ZSA9IHJlcXVpcmUoJ3NlcXVlbGl6ZScpXG5cbi8qIGxldCBDUlVEU2VydmljZSA9IHJlcXVpcmUocGF0aC5qb2luKF9fZGlybmFtZSwgJ2NydWQtc2VydmljZScpKSAqL1xuXG5jb25zdCBUQUcgPSAnQ291cnNlU2VydmljZSdcblxuZXhwb3J0IGludGVyZmFjZSBUb3BpY0RldGFpbHMge1xuICB0b3BpY3M6IHtcbiAgICB0b3BpY0lkOiBudW1iZXJcbiAgICB0b3BpY05vOiBudW1iZXJcbiAgICB0b3BpYzogUGFydGlhbDxUb3BpYz5cbiAgICBzdGFyQmFkZ2U6IG51bWJlclxuICAgIHRpbWVCYWRnZTogbnVtYmVyXG4gICAgc3VidG9waWNzOiB7XG4gICAgICBzdWJ0b3BpY0lkOiBudW1iZXJcbiAgICAgIHN1YnRvcGljTm86IG51bWJlclxuICAgICAgc3VidG9waWM6IFBhcnRpYWw8U3VidG9waWM+XG4gICAgICBzdGFyQmFkZ2U6IG51bWJlclxuICAgICAgdGltZUJhZGdlOiBudW1iZXJcbiAgICAgIHdhdGNoQmFkZ2U6IGJvb2xlYW5cbiAgICB9W11cbiAgfVtdXG59XG5cbmNsYXNzIENvdXJzZVNlcnZpY2UgZXh0ZW5kcyBDUlVEU2VydmljZSB7XG4gIC8vIERldGFpbGVkIGluZm9ybWF0aW9uIGFib3V0IFRvcGljcyAtPiBTdWJ0b3BpY3NcbiAgLy8gSW5jbHVkaW5nIGJhZGdlcyBhY3F1aXJlZCBmb3IgZWFjaCBvZiB0aGVtXG4gIC8vIFRPRE86IFBlcmhhcHMgd2Ugc2hvdWxkIHB1c2ggc29tZSBvZiB0aGUgcXVlcnkgaW50byBzZXBhcmF0ZSB2aWV3cz9cbiAgZ2V0VG9waWNEZXRhaWxzICh1c2VySWQgPSAtMSk6IFByb21pc2U8TkNSZXNwb25zZTxUb3BpY0RldGFpbHM+PiB7XG4gICAgcmV0dXJuIHN1cGVyLnJhd1JlYWRRdWVyeShcbmBcblNFTEVDVFxuICB0b3BpY3MuaWQgQVMgXFxgdG9waWNzLmlkXFxgLCB0b3BpY3MudG9waWNObyBBUyBcXGB0b3BpY3MudG9waWNOb1xcYCwgdG9waWNzLnRvcGljIEFTIFxcYHRvcGljcy50b3BpY1xcYCxcbiAgSUZOVUxMKHN0YXJCYWRnZS5cXGBjb3VudFxcYCwgMCkgQVMgXFxgdG9waWNzLnN0YXJCYWRnZVxcYCxcbiAgSUZOVUxMKHRpbWVCYWRnZS5cXGBjb3VudFxcYCwgMCkgQVMgXFxgdG9waWNzLnRpbWVCYWRnZVxcYCxcbiAgc3VidG9waWNzVmlldy5pZCBBUyBcXGB0b3BpY3Muc3VidG9waWNzLmlkXFxgLCBzdWJ0b3BpY3NWaWV3LnN1YnRvcGljTm8gQVMgXFxgdG9waWNzLnN1YnRvcGljcy5zdWJ0b3BpY05vXFxgLFxuICBzdWJ0b3BpY3NWaWV3LnN1YnRvcGljIEFTIFxcYHRvcGljcy5zdWJ0b3BpY3Muc3VidG9waWNcXGAsXG4gIElGTlVMTChzdWJ0b3BpY3NWaWV3LnN0YXJCYWRnZSwgMCkgQVMgXFxgdG9waWNzLnN1YnRvcGljcy5zdGFyQmFkZ2VcXGAsXG4gIElGTlVMTChzdWJ0b3BpY3NWaWV3LnRpbWVCYWRnZSwgMCkgQVMgXFxgdG9waWNzLnN1YnRvcGljcy50aW1lQmFkZ2VcXGAsXG4gIElGTlVMTChzdWJ0b3BpY3NWaWV3LndhdGNoQmFkZ2UsIDApIEFTIFxcYHRvcGljcy5zdWJ0b3BpY3Mud2F0Y2hCYWRnZVxcYFxuRlJPTSB0b3BpY3NcbkxFRlQgT1VURVIgSk9JTiAoXG4gIFNFTEVDVCBDT1VOVCgqKSBBUyBjb3VudCwgdG9waWNJZFxuICBGUk9NIGdlbmVyYXRlZFRvcGljRXhlcmNpc2VzXG4gIFdIRVJFIHVzZXJJZCA9ICR7dXNlcklkfSBBTkQgc3VibWl0dGVkID0gMSBBTkQgc2NvcmUgPj0gODBcbiAgR1JPVVAgQlkgdG9waWNJZFxuKSBBUyBzdGFyQmFkZ2UgT04gc3RhckJhZGdlLnRvcGljSWQgPSB0b3BpY3MuaWRcbkxFRlQgT1VURVIgSk9JTiAoXG4gIFNFTEVDVCBDT1VOVCgqKSBBUyBjb3VudCwgdG9waWNJZFxuICBGUk9NIGdlbmVyYXRlZFRvcGljRXhlcmNpc2VzXG4gIFdIRVJFIHN1Ym1pdHRlZCA9IDEgQU5EIHVzZXJJZCA9ICR7dXNlcklkfSBBTkQgdGltZUZpbmlzaCA8IGlkZWFsVGltZSBBTkQgc2NvcmUgPSAxMDBcbiAgR1JPVVAgQlkgdG9waWNJZFxuKSBBUyB0aW1lQmFkZ2UgT04gdGltZUJhZGdlLnRvcGljSWQgPSB0b3BpY3MuaWRcbklOTkVSIEpPSU4gKFxuICBTRUxFQ1RcbiAgICBzdWJ0b3BpY3MuaWQgQVMgaWQsIHN1YnRvcGljcy50b3BpY0lkIEFTIHRvcGljSWQsIHN1YnRvcGljcy5zdWJ0b3BpYyBBUyBzdWJ0b3BpYywgc3VidG9waWNzLnN1YnRvcGljTm8gQVMgc3VidG9waWNObyxcbiAgICAoc3RhckJhZGdlLlxcYGNvdW50XFxgIC8gZXhlcmNpc2VzVmlldy5jb3VudCkgQVMgc3RhckJhZGdlLFxuICAgICh0aW1lQmFkZ2UuXFxgY291bnRcXGAgLyBleGVyY2lzZXNWaWV3LmNvdW50KSBBUyB0aW1lQmFkZ2UsXG4gICAgd2F0Y2hCYWRnZS5cXGBjb3VudFxcYCBBUyB3YXRjaEJhZGdlXG4gIEZST00gc3VidG9waWNzXG4gIExFRlQgT1VURVIgSk9JTiAoXG4gICAgU0VMRUNUXG4gICAgICBleGVyY2lzZXMuc3VidG9waWNJZCBBUyBzdWJ0b3BpY0lkLFxuICAgICAgQ09VTlQoKikgQVMgY291bnQsXG4gICAgICBDT1VOVChkaXN0aW5jdCBleGVyY2lzZXMuaWQpIEFTIHRlc3RcbiAgICBGUk9NIGdlbmVyYXRlZEV4ZXJjaXNlc1xuICAgIElOTkVSIEpPSU4gZXhlcmNpc2VzIE9OIGV4ZXJjaXNlcy5pZCA9IGdlbmVyYXRlZEV4ZXJjaXNlcy5leGVyY2lzZUlkXG4gICAgICAgIEFORCBnZW5lcmF0ZWRFeGVyY2lzZXMuc3VibWl0dGVkID0gMSBBTkQgZ2VuZXJhdGVkRXhlcmNpc2VzLnNjb3JlID49IDgwXG4gICAgICAgIEFORCBnZW5lcmF0ZWRFeGVyY2lzZXMudXNlcklkID0gJHt1c2VySWR9XG4gICAgR1JPVVAgQlkgZXhlcmNpc2VzLnN1YnRvcGljSWQsIGdlbmVyYXRlZEV4ZXJjaXNlcy51c2VySWRcbiAgKSBBUyBzdGFyQmFkZ2UgT04gc3RhckJhZGdlLnN1YnRvcGljSWQgPSBzdWJ0b3BpY3MuaWRcbiAgTEVGVCBPVVRFUiBKT0lOIChcbiAgICBTRUxFQ1RcbiAgICAgIGV4ZXJjaXNlcy5zdWJ0b3BpY0lkIEFTIHN1YnRvcGljSWQsXG4gICAgICBDT1VOVCgqKSBBUyBjb3VudFxuICAgIEZST00gZ2VuZXJhdGVkRXhlcmNpc2VzXG4gICAgSU5ORVIgSk9JTiBleGVyY2lzZXMgT04gZXhlcmNpc2VzLmlkID0gZ2VuZXJhdGVkRXhlcmNpc2VzLmV4ZXJjaXNlSWRcbiAgICAgICAgQU5EIGdlbmVyYXRlZEV4ZXJjaXNlcy5zdWJtaXR0ZWQgPSAxIEFORCBnZW5lcmF0ZWRFeGVyY2lzZXMuc2NvcmUgPSAxMDAgQU5EIHRpbWVGaW5pc2ggPCBpZGVhbFRpbWVcbiAgICAgICAgQU5EIGdlbmVyYXRlZEV4ZXJjaXNlcy51c2VySWQgPSAke3VzZXJJZH1cbiAgICBHUk9VUCBCWSBleGVyY2lzZXMuc3VidG9waWNJZCwgZ2VuZXJhdGVkRXhlcmNpc2VzLnVzZXJJZFxuICApIEFTIHRpbWVCYWRnZSBPTiB0aW1lQmFkZ2Uuc3VidG9waWNJZCA9IHN1YnRvcGljcy5pZFxuICBMRUZUIE9VVEVSIEpPSU4gKFxuICAgIFNFTEVDVCB2aWRlb3Muc3VidG9waWNJZCBBUyBzdWJ0b3BpY0lkLCAxIEFTIGNvdW50XG4gICAgRlJPTSB2aWRlb3NcbiAgICBJTk5FUiBKT0lOIHdhdGNoZWRWaWRlb3Mgb24gd2F0Y2hlZFZpZGVvcy52aWRlb0lkID0gdmlkZW9zLmlkIEFORCB3YXRjaGVkVmlkZW9zLnVzZXJJZCA9ICR7dXNlcklkfVxuICAgIExJTUlUIDFcbiAgKSBBUyB3YXRjaEJhZGdlIE9OIHdhdGNoQmFkZ2Uuc3VidG9waWNJZCA9IHN1YnRvcGljcy5pZFxuICBMRUZUIE9VVEVSIEpPSU4gKFxuICAgIFNFTEVDVCBzdWJ0b3BpY0lkLCBDT1VOVChpZCkgQVMgY291bnRcbiAgICBGUk9NIGV4ZXJjaXNlc1xuICAgIEdST1VQIEJZIHN1YnRvcGljSWRcbiAgKSBBUyBleGVyY2lzZXNWaWV3IE9OIGV4ZXJjaXNlc1ZpZXcuc3VidG9waWNJZCA9IHN1YnRvcGljcy5pZFxuKSBBUyBzdWJ0b3BpY3NWaWV3IE9OIHN1YnRvcGljc1ZpZXcudG9waWNJZCA9IHRvcGljcy5pZFxuT1JERVIgQlkgdG9waWNObywgc3VidG9waWNObyBBU0NcbmBcbiAgICApLnRoZW4ocmVzcCA9PiB7XG4gICAgICBpZiAocmVzcC5zdGF0dXMpIHtcbiAgICAgICAgcmV0dXJuIHsgc3RhdHVzOiB0cnVlLCBkYXRhOiBGb3JtYXR0ZXIub2JqZWN0aWZ5KHJlc3AuZGF0YSlbMF0gfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHsgc3RhdHVzOiBmYWxzZSwgZXJyTWVzc2FnZTogcmVzcC5lcnJNZXNzYWdlIH1cbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgZ2V0QWxsVG9waWNzICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRNb2RlbHMoJ1RvcGljJykuZmluZEFsbCh7IG9yZGVyOiBbWyd0b3BpY05vJywgJ0FTQyddXSB9KS50aGVuKHJlc3AgPT4ge1xuICAgICAgcmV0dXJuIHsgc3RhdHVzOiB0cnVlLCBkYXRhOiByZXNwIH1cbiAgICB9KVxuICB9XG5cbiAgZ2V0QWxsU3VidG9waWNzICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRNb2RlbHMoJ1N1YnRvcGljJykuZmluZEFsbCh7IG9yZGVyOiBbWydzdWJ0b3BpY05vJywgJ0FTQyddXSB9KS50aGVuKHJlc3AgPT4ge1xuICAgICAgcmV0dXJuIHsgc3RhdHVzOiB0cnVlLCBkYXRhOiByZXNwIH1cbiAgICB9KVxuICB9XG5cbiAgZ2V0VG9waWNEZXBlbmRlbmNpZXMgKHRvcGljSWQpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTZXF1ZWxpemUoKS5xdWVyeShcbiAgICAgIGBTRUxFQ1QgdG9waWNEZXBlbmRlbmNpZXMuaWQsIHRvcGljRGVwZW5kZW5jaWVzLmRlc2NyaXB0aW9uLCB0b3BpY0RlcGVuZGVuY2llcy51cGRhdGVkQXQsIHRvcGljcy50b3BpYyBhcyBkZXBlbmRlbmN5TmFtZSBGUk9NIHRvcGljRGVwZW5kZW5jaWVzIElOTkVSIEpPSU4gdG9waWNzIE9OIHRvcGljcy5pZCA9IHRvcGljRGVwZW5kZW5jaWVzLmRlcGVuZGVuY3lJZCBXSEVSRSB0b3BpY0RlcGVuZGVuY2llcy50b3BpY0lkPSR7dG9waWNJZH1gLFxuICAgICAgeyB0eXBlOiBTZXF1ZWxpemUuUXVlcnlUeXBlcy5TRUxFQ1QgfSlcbiAgICAgIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICByZXR1cm4geyBzdGF0dXM6IHRydWUsIGRhdGEgfVxuICAgICAgfSlcbiAgfVxuXG4gIGFkZFRvcGljRGVwZW5kZW5jeSAodG9waWNJZCwgZGVwZW5kZW5jeU5hbWUsIGRlc2NyaXB0aW9uKSB7XG4gICAgcmV0dXJuIHRoaXMucmVhZDxUb3BpYz4oeyBtb2RlbE5hbWU6ICdUb3BpYycsIHNlYXJjaENsYXVzZTogeyB0b3BpYzogZGVwZW5kZW5jeU5hbWUgfSB9KS50aGVuKHJlc3AgPT4ge1xuICAgICAgaWYgKHJlc3Auc3RhdHVzICYmIHJlc3AuZGF0YSkge1xuICAgICAgICBjb25zdCBkZXBlbmRlbmN5VG9waWMgPSByZXNwLmRhdGFbMF1cbiAgICAgICAgaWYgKGRlcGVuZGVuY3lUb3BpYy5pZCA9PT0gcGFyc2VJbnQodG9waWNJZCwgMTApKSB7XG4gICAgICAgICAgcmV0dXJuIHsgc3RhdHVzOiBmYWxzZSwgZXJyTWVzc2FnZTogJ0EgdG9waWMgY291bGQgbm90IGRlcGVuZCBvbiBpdHNlbGYhJyB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlPFRvcGljRGVwZW5kZW5jeT4oeyBtb2RlbE5hbWU6ICdUb3BpY0RlcGVuZGVuY3knLCBkYXRhOiB7IHRvcGljSWQsIGRlcGVuZGVuY3lJZDogZGVwZW5kZW5jeVRvcGljLmlkLCBkZXNjcmlwdGlvbiB9IH0pXG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB7IHN0YXR1czogZmFsc2UsIGVyck1lc3NhZ2U6IGBDb3VsZCBub3QgZmluZCB0b3BpYyB3aXRoIG5hbWUgXCIke2RlcGVuZGVuY3lOYW1lfVwiYCB9XG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIGdldFN1YnRvcGljQnlUb3BpY0lkICh0b3BpY0lkKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0TW9kZWxzKCdTdWJ0b3BpYycpLmZpbmRBbGwoeyB3aGVyZTogeyB0b3BpY0lkIH0sIG9yZGVyOiBbWydzdWJ0b3BpY05vJywgJ0FTQyddXSB9KS50aGVuKGRhdGEgPT4ge1xuICAgICAgcmV0dXJuIHsgc3RhdHVzOiB0cnVlLCBkYXRhIH1cbiAgICB9KVxuICB9XG5cbiAgZ2V0RXhlcmNpc2VCeVN1YnRvcGljSWQgKHN1YnRvcGljSWQpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRNb2RlbHMoJ0V4ZXJjaXNlJykuZmluZEFsbCh7IHdoZXJlOiB7IHN1YnRvcGljSWQgfSwgb3JkZXI6IFtbJ2lkJywgJ0FTQyddXSB9KS50aGVuKGRhdGEgPT4ge1xuICAgICAgcmV0dXJuIHsgc3RhdHVzOiB0cnVlLCBkYXRhIH1cbiAgICB9KVxuICB9XG5cbiAgZ2V0U3VidG9waWMgKHN1YnRvcGljSWQpOiBQcm9taXNlPE5DUmVzcG9uc2U8U3VidG9waWM+PiB7XG4gICAgcmV0dXJuIHRoaXMucmVhZE9uZTxTdWJ0b3BpYz4oe1xuICAgICAgbW9kZWxOYW1lOiAnU3VidG9waWMnLFxuICAgICAgc2VhcmNoQ2xhdXNlOiB7IGlkOiBzdWJ0b3BpY0lkIH0sXG4gICAgICBpbmNsdWRlOiBbeyBtb2RlbDogdGhpcy5nZXRNb2RlbHMoJ1RvcGljJykgfV1cbiAgICB9KVxuICB9XG5cbiAgZ2V0T3JkZXJlZFRvcGljcyAoKTogUHJvbWlzZTxOQ1Jlc3BvbnNlPFRvcGljW10+PiB7XG4gICAgcmV0dXJuIHRoaXMucmVhZDxUb3BpYz4oeyBtb2RlbE5hbWU6ICdUb3BpYycsIG9yZGVyOiBbWyd0b3BpY05vJywgJ0FTQyddXSwgc2VhcmNoQ2xhdXNlOiB7fSB9KVxuICB9XG5cbiAgZ2V0VG9waWMgKHRvcGljSWQpIHtcbiAgICByZXR1cm4gdGhpcy5yZWFkT25lPFRvcGljPih7IG1vZGVsTmFtZTogJ1RvcGljJywgc2VhcmNoQ2xhdXNlOiB7IGlkOiB0b3BpY0lkIH0gfSlcbiAgfVxuXG4gIGdldEV4ZXJjaXNlcyAoc3VidG9waWNJZCkge1xuICAgIHJldHVybiB0aGlzLnJlYWQ8RXhlcmNpc2U+KHsgbW9kZWxOYW1lOiAnRXhlcmNpc2UnLCBzZWFyY2hDbGF1c2U6IHsgc3VidG9waWNJZCB9LCBvcmRlcjogW1snaWQnLCAnQVNDJ11dIH0pXG4gIH1cblxuICBnZXRQcmV2aW91c0FuZE5leHRFeGVyY2lzZSAoc3VidG9waWNJZCwgZXhlcmNpc2VJZCk6IFByb21pc2U8TkNSZXNwb25zZTx7IG5leHQ/OiBFeGVyY2lzZSwgcHJldj86IEV4ZXJjaXNlfT4+IHtcbiAgICByZXR1cm4gUHJvbWlzZS5qb2luKFxuICAgICAgdGhpcy5yZWFkT25lKHtcbiAgICAgICAgbW9kZWxOYW1lOiAnRXhlcmNpc2UnLFxuICAgICAgICBzZWFyY2hDbGF1c2U6IHtcbiAgICAgICAgICBbU2VxdWVsaXplLk9wLmFuZF06IHtcbiAgICAgICAgICAgIGlkOiB7XG4gICAgICAgICAgICAgIFtTZXF1ZWxpemUuT3AubHRdOiBleGVyY2lzZUlkXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VidG9waWNJZFxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgb3JkZXI6IFtbJ2lkJywgJ0RFU0MnXV0sXG4gICAgICAgIGluY2x1ZGU6IFt7XG4gICAgICAgICAgbW9kZWw6IHRoaXMuZ2V0TW9kZWxzKCdTdWJ0b3BpYycpLFxuICAgICAgICAgIGluY2x1ZGU6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgbW9kZWw6IHRoaXMuZ2V0TW9kZWxzKCdUb3BpYycpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXVxuICAgICAgICB9XVxuICAgICAgfSksXG4gICAgICB0aGlzLnJlYWRPbmUoe1xuICAgICAgICBtb2RlbE5hbWU6ICdFeGVyY2lzZScsXG4gICAgICAgIHNlYXJjaENsYXVzZToge1xuICAgICAgICAgIFtTZXF1ZWxpemUuT3AuYW5kXToge1xuICAgICAgICAgICAgaWQ6IHtcbiAgICAgICAgICAgICAgW1NlcXVlbGl6ZS5PcC5ndF06IGV4ZXJjaXNlSWRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWJ0b3BpY0lkXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBvcmRlcjogW1snaWQnLCAnQVNDJ11dLFxuICAgICAgICBpbmNsdWRlOiBbe1xuICAgICAgICAgIG1vZGVsOiB0aGlzLmdldE1vZGVscygnU3VidG9waWMnKSxcbiAgICAgICAgICBpbmNsdWRlOiBbeyBtb2RlbDogdGhpcy5nZXRNb2RlbHMoJ1RvcGljJykgfV1cbiAgICAgICAgfV1cbiAgICAgIH0pKS5zcHJlYWQoKHJlc3AxOiBOQ1Jlc3BvbnNlPEV4ZXJjaXNlPiwgcmVzcDI6IE5DUmVzcG9uc2U8RXhlcmNpc2U+KSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3RhdHVzOiB0cnVlLFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHByZXY6IHJlc3AxLmRhdGEsXG4gICAgICAgICAgICBuZXh0OiByZXNwMi5kYXRhXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KVxuICB9XG5cbiAgZ2V0UHJldmlvdXNBbmROZXh0U3VidG9waWMgKHN1YnRvcGljSWQpOiBQcm9taXNlPE5DUmVzcG9uc2U8eyBuZXh0PzogU3VidG9waWMsIHByZXY/OiBTdWJ0b3BpY30+PiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3VidG9waWMoc3VidG9waWNJZCkudGhlbihyZXNwID0+IHtcbiAgICAgIGlmIChyZXNwLnN0YXR1cyAmJiByZXNwLmRhdGEpIHtcbiAgICAgICAgY29uc3Qgc3VidG9waWNObyA9IHJlc3AuZGF0YS5zdWJ0b3BpY05vXG4gICAgICAgIHJldHVybiBQcm9taXNlLmpvaW4oXG4gICAgICAgICAgdGhpcy5yZWFkT25lPFN1YnRvcGljPih7XG4gICAgICAgICAgICBtb2RlbE5hbWU6ICdTdWJ0b3BpYycsXG4gICAgICAgICAgICBzZWFyY2hDbGF1c2U6IHsgc3VidG9waWNObzogeyBbU2VxdWVsaXplLk9wLmx0XTogc3VidG9waWNObyB9IH0sXG4gICAgICAgICAgICBpbmNsdWRlOiBbeyBtb2RlbDogdGhpcy5nZXRNb2RlbHMoJ1RvcGljJykgfV0sXG4gICAgICAgICAgICBvcmRlcjogW1snc3VidG9waWNObycsICdERVNDJ11dXG4gICAgICAgICAgfSksXG4gICAgICAgICAgdGhpcy5yZWFkT25lPFN1YnRvcGljPih7XG4gICAgICAgICAgICBtb2RlbE5hbWU6ICdTdWJ0b3BpYycsXG4gICAgICAgICAgICBzZWFyY2hDbGF1c2U6IHsgc3VidG9waWNObzogeyBbU2VxdWVsaXplLk9wLmd0XTogc3VidG9waWNObyB9IH0sXG4gICAgICAgICAgICBpbmNsdWRlOiBbeyBtb2RlbDogdGhpcy5nZXRNb2RlbHMoJ1RvcGljJykgfV0sXG4gICAgICAgICAgICBvcmRlcjogW1snc3VidG9waWNObycsICdBU0MnXV1cbiAgICAgICAgICB9KVxuICAgICAgICApLnNwcmVhZCgocmVzcDI6IE5DUmVzcG9uc2U8U3VidG9waWM+LCByZXNwMzogTkNSZXNwb25zZTxTdWJ0b3BpYz4pID0+IHtcbiAgICAgICAgICByZXR1cm4geyBzdGF0dXM6IHRydWUsIGRhdGE6IHsgcHJldjogcmVzcDIuZGF0YSwgbmV4dDogcmVzcDMuZGF0YSB9IH0gYXMgTkNSZXNwb25zZTxhbnk+XG4gICAgICAgIH0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4geyBzdGF0dXM6IGZhbHNlLCBlcnJNZXNzYWdlOiByZXNwLmVyck1lc3NhZ2UgfVxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICAvLyBBbHRob3VnaCB0aGVyZSBvbmUgc3VidG9waWMgY2FuIGhhdmUgbXVsdGlwbGUgdmlkZW9zIChyZWNvcmQgb2YgcGFzdCB1cGxvYWRzKSxcbiAgLy8gd2UgY2FyZSBvbmx5IGlmIGF0IGxlYXN0IG9uZSBoYWQgYmVlbiB3YXRjaGVkXG4gIC8vIHJldHVybjogeyBzdGF0dXM6IHRydWUsIGRhdGE6IHsgd2F0Y2hlZDogdHJ1ZSB9fVxuICBpc1N1YnRvcGljVmlkZW9XYXRjaGVkIChzdWJ0b3BpY0lkLCB1c2VySWQpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTZXF1ZWxpemUoKS5xdWVyeShcbmBcbiAgU0VMRUNUIHN1YnRvcGljcy5pZCBBUyBzdWJ0b3BpY0lkLCB0cnVlIEFTIHdhdGNoZWRcbiAgIEZST00gc3VidG9waWNzXG4gICBJTk5FUiBKT0lOIHZpZGVvcyBPTiB2aWRlb3Muc3VidG9waWNJZCA9IHN1YnRvcGljcy5pZFxuICAgSU5ORVIgSk9JTiB3YXRjaGVkVmlkZW9zIG9uIHdhdGNoZWRWaWRlb3MudmlkZW9JZCA9IHZpZGVvcy5pZFxuICAgV0hFUkUgc3VidG9waWNzLmlkID0gJHtzdWJ0b3BpY0lkfSBBTkQgd2F0Y2hlZFZpZGVvcy51c2VySWQgPSAke3VzZXJJZH1cbiAgIExJTUlUIDE7XG5gLCB7IHR5cGU6IHRoaXMuZ2V0U2VxdWVsaXplKCkuUXVlcnlUeXBlcy5TRUxFQ1QgfSkudGhlbihkYXRhID0+IHtcbiAgbGV0IHdhdGNoZWQgPSBmYWxzZVxuICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgd2F0Y2hlZCA9IHRydWVcbiAgfVxuICByZXR1cm4geyBzdGF0dXM6IHRydWUsIGRhdGE6IHsgd2F0Y2hlZCB9IH1cbn0pXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgbmV3IENvdXJzZVNlcnZpY2UoKVxuIl19
