const path=require("path"),log=require("npmlog"),AppConfig=require(path.join(__dirname,"../../app-config")),BaseController=require(path.join(__dirname,"base-controller")),ImageService=require(path.join(__dirname,"../../services/image-service")),PathFormatter=require(path.join(__dirname,"../../lib/path-formatter")),StudentMonitorService=require(path.join(__dirname,"../../services/student-monitor-service")),TAG="StudentMonitorController";class StudentMonitorController extends BaseController{constructor(e){super(e);const t=new StudentMonitorService(this.getDb().sequelize,this.getDb().models);new ImageService(this.getDb().sequelize,this.getDb().models);this.addInterceptor((e,t,r)=>{log.verbose(TAG,"req.path="+e.path),r()}),this.routeGet("/student-monitor",(e,t,r)=>{t.render("student-monitor")}),this.routeGet("/student-monitor/last-hour-summary",(e,r,o)=>{const s=e.query.schoolId,n="true"===e.query.showAllStudents;s?t.getLastHourStats(s,n).then(e=>{r.json(e)}).catch(o):r.json({status:!1,errMessage:"schoolId is required!"})}),this.routeGet("/student-monitor/last-submissions",(e,r,o)=>{const s=e.query.userId;t.getLastNSubmissions(s,30).then(e=>{r.json(e)}).catch(o)})}}module.exports=StudentMonitorController;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jbXMvY29udHJvbGxlcnMvc3R1ZGVudC1tb25pdG9yLWNvbnRyb2xsZXIuanMiXSwibmFtZXMiOlsicGF0aCIsInJlcXVpcmUiLCJsb2ciLCJBcHBDb25maWciLCJqb2luIiwiX19kaXJuYW1lIiwiQmFzZUNvbnRyb2xsZXIiLCJJbWFnZVNlcnZpY2UiLCJQYXRoRm9ybWF0dGVyIiwiU3R1ZGVudE1vbml0b3JTZXJ2aWNlIiwiVEFHIiwiU3R1ZGVudE1vbml0b3JDb250cm9sbGVyIiwiW29iamVjdCBPYmplY3RdIiwiaW5pdERhdGEiLCJzdXBlciIsInN0dWRlbnRNb25pdG9yU2VydmljZSIsInRoaXMiLCJnZXREYiIsInNlcXVlbGl6ZSIsIm1vZGVscyIsImFkZEludGVyY2VwdG9yIiwicmVxIiwicmVzIiwibmV4dCIsInZlcmJvc2UiLCJyb3V0ZUdldCIsInJlbmRlciIsInNjaG9vbElkIiwicXVlcnkiLCJzaG93QWxsU3R1ZGVudHMiLCJnZXRMYXN0SG91clN0YXRzIiwidGhlbiIsInJlc3AiLCJqc29uIiwiY2F0Y2giLCJzdGF0dXMiLCJlcnJNZXNzYWdlIiwidXNlcklkIiwiZ2V0TGFzdE5TdWJtaXNzaW9ucyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLEtBQU9DLFFBQVEsUUFFZkMsSUFBTUQsUUFBUSxVQUVkRSxVQUFZRixRQUFRRCxLQUFLSSxLQUFLQyxVQUFXLHFCQUV6Q0MsZUFBaUJMLFFBQVFELEtBQUtJLEtBQUtDLFVBQVcsb0JBQzlDRSxhQUFlTixRQUFRRCxLQUFLSSxLQUFLQyxVQUFXLGlDQUM1Q0csY0FBZ0JQLFFBQVFELEtBQUtJLEtBQUtDLFVBQVcsNkJBQzdDSSxzQkFBd0JSLFFBQVFELEtBQUtJLEtBQUtDLFVBQVcsMkNBRXJESyxJQUFNLGlDQUNaQyxpQ0FBdUNMLGVBQ3JDTSxZQUFhQyxHQUNYQyxNQUFNRCxHQUNOLE1BQU1FLEVBQXdCLElBQUlOLHNCQUFzQk8sS0FBS0MsUUFBUUMsVUFBV0YsS0FBS0MsUUFBUUUsUUFDeEUsSUFBSVosYUFBYVMsS0FBS0MsUUFBUUMsVUFBV0YsS0FBS0MsUUFBUUUsUUFFM0VILEtBQUtJLGVBQWUsQ0FBQ0MsRUFBS0MsRUFBS0MsS0FDN0JyQixJQUFJc0IsUUFBUWQsSUFBSyxZQUFjVyxFQUFJckIsTUFDbkN1QixNQUdGUCxLQUFLUyxTQUFTLG1CQUFvQixDQUFDSixFQUFLQyxFQUFLQyxLQUMzQ0QsRUFBSUksT0FBTyxxQkFHYlYsS0FBS1MsU0FBUyxxQ0FBc0MsQ0FBQ0osRUFBS0MsRUFBS0MsS0FDN0QsTUFBTUksRUFBV04sRUFBSU8sTUFBTUQsU0FDckJFLEVBQWdELFNBQTlCUixFQUFJTyxNQUFNQyxnQkFDOUJGLEVBQ0ZaLEVBQXNCZSxpQkFBaUJILEVBQVVFLEdBQWlCRSxLQUFLQyxJQUNyRVYsRUFBSVcsS0FBS0QsS0FDUkUsTUFBTVgsR0FFVEQsRUFBSVcsTUFBTUUsUUFBUSxFQUFPQyxXQUFZLDRCQUl6Q3BCLEtBQUtTLFNBQVMsb0NBQXFDLENBQUNKLEVBQUtDLEVBQUtDLEtBQzVELE1BQU1jLEVBQVNoQixFQUFJTyxNQUFNUyxPQUN6QnRCLEVBQXNCdUIsb0JBQW9CRCxFQUFRLElBQUlOLEtBQUtDLElBQ3pEVixFQUFJVyxLQUFLRCxLQUNSRSxNQUFNWCxNQUtmZ0IsT0FBT0MsUUFBVTdCIiwiZmlsZSI6ImNtcy9jb250cm9sbGVycy9zdHVkZW50LW1vbml0b3ItY29udHJvbGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJylcblxuY29uc3QgbG9nID0gcmVxdWlyZSgnbnBtbG9nJylcblxuY29uc3QgQXBwQ29uZmlnID0gcmVxdWlyZShwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vLi4vYXBwLWNvbmZpZycpKVxuXG5jb25zdCBCYXNlQ29udHJvbGxlciA9IHJlcXVpcmUocGF0aC5qb2luKF9fZGlybmFtZSwgJ2Jhc2UtY29udHJvbGxlcicpKVxuY29uc3QgSW1hZ2VTZXJ2aWNlID0gcmVxdWlyZShwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vLi4vc2VydmljZXMvaW1hZ2Utc2VydmljZScpKVxuY29uc3QgUGF0aEZvcm1hdHRlciA9IHJlcXVpcmUocGF0aC5qb2luKF9fZGlybmFtZSwgJy4uLy4uL2xpYi9wYXRoLWZvcm1hdHRlcicpKVxuY29uc3QgU3R1ZGVudE1vbml0b3JTZXJ2aWNlID0gcmVxdWlyZShwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vLi4vc2VydmljZXMvc3R1ZGVudC1tb25pdG9yLXNlcnZpY2UnKSlcblxuY29uc3QgVEFHID0gJ1N0dWRlbnRNb25pdG9yQ29udHJvbGxlcidcbmNsYXNzIFN0dWRlbnRNb25pdG9yQ29udHJvbGxlciBleHRlbmRzIEJhc2VDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IgKGluaXREYXRhKSB7XG4gICAgc3VwZXIoaW5pdERhdGEpXG4gICAgY29uc3Qgc3R1ZGVudE1vbml0b3JTZXJ2aWNlID0gbmV3IFN0dWRlbnRNb25pdG9yU2VydmljZSh0aGlzLmdldERiKCkuc2VxdWVsaXplLCB0aGlzLmdldERiKCkubW9kZWxzKVxuICAgIGNvbnN0IGltYWdlU2VydmljZSA9IG5ldyBJbWFnZVNlcnZpY2UodGhpcy5nZXREYigpLnNlcXVlbGl6ZSwgdGhpcy5nZXREYigpLm1vZGVscylcblxuICAgIHRoaXMuYWRkSW50ZXJjZXB0b3IoKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICBsb2cudmVyYm9zZShUQUcsICdyZXEucGF0aD0nICsgcmVxLnBhdGgpXG4gICAgICBuZXh0KClcbiAgICB9KVxuXG4gICAgdGhpcy5yb3V0ZUdldCgnL3N0dWRlbnQtbW9uaXRvcicsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgcmVzLnJlbmRlcignc3R1ZGVudC1tb25pdG9yJylcbiAgICB9KVxuXG4gICAgdGhpcy5yb3V0ZUdldCgnL3N0dWRlbnQtbW9uaXRvci9sYXN0LWhvdXItc3VtbWFyeScsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgY29uc3Qgc2Nob29sSWQgPSByZXEucXVlcnkuc2Nob29sSWRcbiAgICAgIGNvbnN0IHNob3dBbGxTdHVkZW50cyA9IHJlcS5xdWVyeS5zaG93QWxsU3R1ZGVudHMgPT09ICd0cnVlJ1xuICAgICAgaWYgKHNjaG9vbElkKSB7XG4gICAgICAgIHN0dWRlbnRNb25pdG9yU2VydmljZS5nZXRMYXN0SG91clN0YXRzKHNjaG9vbElkLCBzaG93QWxsU3R1ZGVudHMpLnRoZW4ocmVzcCA9PiB7XG4gICAgICAgICAgcmVzLmpzb24ocmVzcClcbiAgICAgICAgfSkuY2F0Y2gobmV4dClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcy5qc29uKHtzdGF0dXM6IGZhbHNlLCBlcnJNZXNzYWdlOiAnc2Nob29sSWQgaXMgcmVxdWlyZWQhJ30pXG4gICAgICB9XG4gICAgfSlcblxuICAgIHRoaXMucm91dGVHZXQoJy9zdHVkZW50LW1vbml0b3IvbGFzdC1zdWJtaXNzaW9ucycsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgY29uc3QgdXNlcklkID0gcmVxLnF1ZXJ5LnVzZXJJZFxuICAgICAgc3R1ZGVudE1vbml0b3JTZXJ2aWNlLmdldExhc3ROU3VibWlzc2lvbnModXNlcklkLCAzMCkudGhlbihyZXNwID0+IHtcbiAgICAgICAgcmVzLmpzb24ocmVzcClcbiAgICAgIH0pLmNhdGNoKG5leHQpXG4gICAgfSlcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFN0dWRlbnRNb25pdG9yQ29udHJvbGxlclxuIl19
